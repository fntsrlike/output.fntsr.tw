<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>解決 MySQL 使用 utf8mb4 編碼導致 Rails 資料庫遷移失敗的問題</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="My amazing site.">
<link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="modulepreload" href="/legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.ef07ec96.js"><link rel="preload" as="style" href="/_nuxt/entry.10319964.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.b6929f5c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_...slug_.8ae6e501.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PostHeader.vue_vue_type_script_setup_true_lang.988e3e45.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageTitle.60b3d867.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageSubtitle.678c226e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageDate.vue_vue_type_script_setup_true_lang.adb1a357.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/datetime.91a1a522.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentDoc.7177145d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.6b477ecf.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.3a5a6967.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.1dec55d2.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.726de751.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentQuery.9abfbc96.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/asyncData.64eb1541.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PostHeader.7970c087.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageDate.765473d4.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentNavigation.858e066f.js"><link rel="prefetch" as="style" href="/_nuxt/mermaid-graph-build-in.bc7ba99d.css"><link rel="prefetch" as="style" href="/_nuxt/welcome.5c357e2e.css"><link rel="prefetch" as="style" href="/_nuxt/IconCSS.7e080772.css"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentList.bfe99bb9.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentSlot.3a94b225.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DocumentDrivenEmpty.75a8d73c.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DocumentDrivenNotFound.0674fe95.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Markdown.4f5711e6.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ProseCode.9a23af0b.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/client-db.0b86307f.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/pure.f941fb12.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/web-socket.5c02170f.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.ad271a1f.js"><link rel="stylesheet" href="/_nuxt/entry.10319964.css"><style>.icon[data-v-75a0dd67]{display:inline-block;vertical-align:middle}</style><script>"use strict";const w=window,de=document.documentElement,knownColorSchemes=["dark","light"],preference=window.localStorage.getItem("nuxt-color-mode")||"system";let value=preference==="system"?getColorScheme():preference;const forcedColorMode=de.getAttribute("data-color-mode-forced");forcedColorMode&&(value=forcedColorMode),addColorScheme(value),w["__NUXT_COLOR_MODE__"]={preference,value,getColorScheme,addColorScheme,removeColorScheme};function addColorScheme(e){const o=""+e+"",t="";de.classList?de.classList.add(o):de.className+=" "+o,t&&de.setAttribute("data-"+t,e)}function removeColorScheme(e){const o=""+e+"",t="";de.classList?de.classList.remove(o):de.className=de.className.replace(new RegExp(o,"g"),""),t&&de.removeAttribute("data-"+t)}function prefersColorScheme(e){return w.matchMedia("(prefers-color-scheme"+e+")")}function getColorScheme(){if(w.matchMedia&&prefersColorScheme("").media!=="not all"){for(const e of knownColorSchemes)if(prefersColorScheme(":"+e).matches)return e}return"light"}
</script></head>
<body class="bg-white text-black antialiased dark:bg-neutral-900 dark:text-white"><div id="__nuxt"><div><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-4xl xl:px-0"><!--[--><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between pt-6 pb-10"><div><a href="/" class="" aria-label="深藏若虛"><div class="flex items-center justify-between"><div class="h-6 text-2xl font-semibold sm:block">深藏若虛</div></div></a><p class="hidden mt-2 text-xs sm:block">Digital Garden of @fntsr</p></div><div class="flex items-center text-base leading-5"><nav class="hidden sm:block"><!--[--><a href="/about" class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4">About</a><a href="/articles" class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4">Articles</a><a href="/notes" class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4">Notes</a><a href="/moc" class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4">MoC</a><!--]--></nav><button aria-label="Toggle Dark Mode" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="text-gray-900 dark:text-gray-100"><path style="display:none;" fillRule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clipRule="evenodd"></path><path style="display:none;" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fillRule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clipRule="evenodd"></path></svg></button><div class="translate-x-full fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800"><div class="flex justify-end"><button class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><!--[--><div class="px-12 py-4"><a href="/about" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">About</a></div><div class="px-12 py-4"><a href="/articles" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Articles</a></div><div class="px-12 py-4"><a href="/notes" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Notes</a></div><div class="px-12 py-4"><a href="/moc" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">MoC</a></div><!--]--></nav></div></div></div></header><main class="mb-auto"><!--[--><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-4xl xl:px-0"><!--[--><!--[--><!--[--><!--[--><!--[--><header class="mb-4 pb-6"><h1 class="tracking-tight font-extrabold text-gray-900 dark:text-gray-100 sm:text-3xl sm:leading-8 sm:mb-2 text-2xl leading-6 mb-1"><!--[-->解決 MySQL 使用 utf8mb4 編碼導致 Rails 資料庫遷移失敗的問題<!--]--></h1><h2 class="tracking-tight font-medium text-gray-700 dark:text-gray-300 sm:text-xl sm:leading-8 sm:mb-2 text-lg leading-7 mb-2" lang="en"><!--[-->MySQL utf8mb4 breaks ActiveRecord schema setup<!--]--></h2><div class="text-sm text-gray-600 dark:text-gray-400"><!----><!----></div></header><div class="flex p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert"><svg aria-hidden="true" class="flex-shrink-0 inline w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="sr-only">Info</span><div><span class="font-medium">本文尚待整理中！</span> 本文是舊部落格的文章，會陸續整理到新的內容架構，敬請期待。 </div></div><div></div><!--]--><!--]--><!--]--><!--]--><!--]--></section><!--]--></main><footer><div class="sm:relative flex flex-col items-center gap-3 sm:flex-row sm:justify-between py-6"><div class="flex flex-col-reverse items-center gap-3 sm:flex-row sm:w-56 md:w-60"><div class="flex flex-col items-center"><div class="flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2013 - 2023</div><div> • </div><a href="/" class="">深藏若虛</a></div><div class="text-sm text-gray-500 dark:text-gray-400 items-left"><div>Yuehu Lin</div></div></div></div><ul class="flex flex-wrap justify-center text-sm gap-x-6 gap-y-2"><!--[--><li><a href="/announce" class="font-medium text-gray-500 hover:text-gray-900 focus:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 dark:focus:text-gray-300">Announce</a></li><li><a href="/tags" class="font-medium text-gray-500 hover:text-gray-900 focus:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 dark:focus:text-gray-300">Tags</a></li><!--]--></ul><div class="flex items-center justify-end gap-3 z-10 sm:w-40 md:w-60"><div><!--[--><a class="text-sm text-gray-500 transition hover:text-gray-600 mr-6" target="_blank" rel="noopener noreferrer" href="me@fntsr.tw"><span class="sr-only">email</span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400" style="" width="1.5em" height="1.5em" viewBox="0 0 24 24" data-v-75a0dd67><path fill="currentColor" d="m20 8l-8 5l-8-5V6l8 5l8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600 mr-6" target="_blank" rel="noopener noreferrer" href="https://github.com/fntsrlike"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400" style="" width="1.5em" height="1.5em" viewBox="0 0 24 24" data-v-75a0dd67><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></a><!----><!----><!----><a class="text-sm text-gray-500 transition hover:text-gray-600 mr-6" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/fntsrlike/"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400" style="" width="1.5em" height="1.5em" viewBox="0 0 24 24" data-v-75a0dd67><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77Z"/></svg></a><!--]--></div></div></div></footer></div><!--]--></section></div></div><script type="module">import p from "/legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup/_payload.js";window.__NUXT__={...p,...((function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de){return {state:{"$scolor-mode":{preference:aE,value:aE,unknown:E,forced:l},"$sdd-pages":{"/legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup":{_path:aF,_dir:T,_draft:l,_partial:l,_locale:U,_empty:l,title:V,description:i,excerpt:{type:K,children:[{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:aG,rel:[e]},children:[{type:a,value:aH}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aI}]},{type:b,tag:g,props:{code:W},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:W}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aJ}]},{type:b,tag:g,props:{code:X},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:X}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aK}]},{type:b,tag:k,props:{id:Y},children:[{type:a,value:Z}]},{type:b,tag:c,props:{},children:[{type:a,value:aL}]},{type:b,tag:c,props:{},children:[{type:a,value:aM},{type:b,tag:n,props:{},children:[{type:a,value:aN}]},{type:a,value:aO}]},{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:L,rel:[e]},children:[{type:b,tag:o,props:{alt:i,src:L},children:[]}]}]},{type:b,tag:k,props:{id:_},children:[{type:a,value:$}]},{type:b,tag:c,props:{},children:[{type:a,value:aP},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:aQ},{type:b,tag:f,props:{},children:[{type:a,value:aR}]},{type:a,value:aS}]},{type:b,tag:c,props:{},children:[{type:a,value:aT},{type:b,tag:f,props:{},children:[{type:a,value:aU}]},{type:a,value:aV}]},{type:b,tag:k,props:{id:aa},children:[{type:a,value:ab}]},{type:b,tag:m,props:{id:s},children:[{type:a,value:s}]},{type:b,tag:c,props:{},children:[{type:a,value:aW},{type:b,tag:aX,props:{},children:[{type:a,value:aY}]},{type:a,value:aZ}]},{type:b,tag:c,props:{},children:[{type:a,value:a_},{type:b,tag:f,props:{},children:[{type:a,value:a$}]},{type:a,value:ba}]},{type:b,tag:m,props:{id:t},children:[{type:a,value:t}]},{type:b,tag:c,props:{},children:[{type:a,value:bb},{type:b,tag:d,props:{href:M,rel:[e]},children:[{type:a,value:bc}]},{type:a,value:bd}]},{type:b,tag:c,props:{},children:[{type:a,value:be},{type:b,tag:f,props:{},children:[{type:a,value:bf}]},{type:a,value:bg}]},{type:b,tag:g,props:{code:ac},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:ac}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bh},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bi}]},{type:b,tag:g,props:{code:ad},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:ad}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bj},{type:b,tag:bk,props:{},children:[]},{type:a,value:bl},{type:b,tag:d,props:{href:bm,rel:[e]},children:[{type:a,value:bn}]},{type:a,value:bo}]},{type:b,tag:m,props:{id:u},children:[{type:a,value:u}]},{type:b,tag:c,props:{},children:[{type:a,value:bp},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bq}]},{type:b,tag:c,props:{},children:[{type:a,value:br},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bs},{type:b,tag:d,props:{href:bt,rel:[e]},children:[{type:a,value:bu}]},{type:a,value:B}]},{type:b,tag:k,props:{id:ae},children:[{type:a,value:af}]},{type:b,tag:c,props:{},children:[{type:a,value:bv}]},{type:b,tag:m,props:{id:ag},children:[{type:a,value:s}]},{type:b,tag:c,props:{},children:[{type:a,value:bw},{type:b,tag:f,props:{},children:[{type:a,value:bx}]},{type:a,value:by}]},{type:b,tag:c,props:{},children:[{type:a,value:bz}]},{type:b,tag:m,props:{id:ah},children:[{type:a,value:t}]},{type:b,tag:c,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:bA}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bB},{type:b,tag:f,props:{},children:[{type:a,value:bC}]},{type:a,value:bD}]},{type:b,tag:g,props:{code:ai},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:ai}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bE},{type:b,tag:d,props:{href:bF,rel:[e]},children:[{type:a,value:bG}]},{type:a,value:bH}]},{type:b,tag:F,props:{id:bI},children:[{type:a,value:bJ}]},{type:b,tag:c,props:{},children:[{type:a,value:bK},{type:b,tag:f,props:{},children:[{type:a,value:bL}]},{type:a,value:bM},{type:b,tag:f,props:{},children:[{type:a,value:bN}]},{type:a,value:bO}]},{type:b,tag:g,props:{code:aj},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:aj}]}]}]},{type:b,tag:F,props:{id:bP},children:[{type:a,value:bQ}]},{type:b,tag:c,props:{},children:[{type:a,value:bR}]},{type:b,tag:c,props:{},children:[{type:a,value:bS},{type:b,tag:f,props:{},children:[{type:a,value:bT}]},{type:a,value:bU}]},{type:b,tag:g,props:{code:ak},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:ak}]}]}]},{type:b,tag:m,props:{id:al},children:[{type:a,value:u}]},{type:b,tag:c,props:{},children:[{type:a,value:bV}]},{type:b,tag:k,props:{id:v},children:[{type:a,value:v}]},{type:b,tag:c,props:{},children:[{type:a,value:bW}]},{type:b,tag:k,props:{id:am},children:[{type:a,value:an}]},{type:b,tag:c,props:{},children:[{type:a,value:bX}]},{type:b,tag:c,props:{},children:[{type:a,value:bY}]},{type:b,tag:m,props:{id:ao},children:[{type:a,value:ap}]},{type:b,tag:c,props:{},children:[{type:a,value:bZ},{type:b,tag:d,props:{href:b_,rel:[e]},children:[{type:a,value:N}]},{type:a,value:B}]},{type:b,tag:c,props:{},children:[{type:a,value:b$}]},{type:b,tag:F,props:{id:ca},children:[{type:a,value:cb}]},{type:b,tag:c,props:{},children:[{type:a,value:cc}]},{type:b,tag:c,props:{},children:[{type:a,value:cd},{type:b,tag:d,props:{href:ce,rel:[e]},children:[{type:a,value:O}]}]},{type:b,tag:k,props:{id:G},children:[{type:a,value:G}]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:M,rel:[e]},children:[{type:a,value:cf}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:cg,rel:[e]},children:[{type:a,value:ch}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:ci,rel:[e]},children:[{type:a,value:cj}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:ck,rel:[e]},children:[{type:a,value:cl}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:cm,rel:[e]},children:[{type:a,value:cn}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:co,rel:[e]},children:[{type:a,value:cp}]}]}]},{type:b,tag:P,props:{},children:[]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:cq},{type:b,tag:f,props:{},children:[{type:a,value:cr}]},{type:a,value:cs},{type:b,tag:f,props:{},children:[{type:a,value:ct}]},{type:a,value:cu},{type:b,tag:d,props:{href:cv,rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]},{type:b,tag:h,props:{},children:[{type:a,value:cw},{type:b,tag:d,props:{href:cx,rel:[e]},children:[{type:a,value:cy}]},{type:a,value:cz},{type:b,tag:d,props:{href:cA,rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]}]}]},title_en:cB,slug:"my-sql-utf-8-mb-4-breaks-active-record-schema-setup",aliases:[V,cB],created_at:"2016-02-21T23:30:29.000Z",published_at:H,updated_at:H,tags:["database","mysql","ruby-on-rails","web"],moc:[aq],body:{type:K,children:[{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:aG,rel:[e]},children:[{type:a,value:aH}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aI}]},{type:b,tag:g,props:{code:W},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"~\u002Fapp $ RAILS_ENV=production rake db:migrate\n\n== 20150226092347 DeviseCreateUsers: migrating================================\n-- create_table(:users)\n   -\u003E 0.0070s\n-- add_index(:users, :email, {:unique=\u003Etrue})\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\nMysql2::Error: Specified key was too long; max key length is 767 bytes: CREATE UNIQUE INDEX `index_users_on_email`  ON `users` (`email`) ~\u002F.rvm\u002Fgems\u002Fruby-2.2.2\u002Fgems\u002Fmysql2-0.4.2\u002Flib\u002Fmysql2\u002Fclient.rb:107:in `_query'\n......"}]}]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aJ}]},{type:b,tag:g,props:{code:X},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"Mysql2::Error: Specified key was too long; max key length is 767 bytes"}]}]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:aK}]},{type:b,tag:k,props:{id:Y},children:[{type:a,value:Z}]},{type:b,tag:c,props:{},children:[{type:a,value:aL}]},{type:b,tag:c,props:{},children:[{type:a,value:aM},{type:b,tag:n,props:{},children:[{type:a,value:aN}]},{type:a,value:aO}]},{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:L,rel:[e]},children:[{type:b,tag:o,props:{alt:i,src:L},children:[]}]}]},{type:b,tag:k,props:{id:_},children:[{type:a,value:$}]},{type:b,tag:c,props:{},children:[{type:a,value:aP},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:aQ},{type:b,tag:f,props:{},children:[{type:a,value:aR}]},{type:a,value:aS}]},{type:b,tag:c,props:{},children:[{type:a,value:aT},{type:b,tag:f,props:{},children:[{type:a,value:aU}]},{type:a,value:aV}]},{type:b,tag:k,props:{id:aa},children:[{type:a,value:ab}]},{type:b,tag:m,props:{id:s},children:[{type:a,value:s}]},{type:b,tag:c,props:{},children:[{type:a,value:aW},{type:b,tag:aX,props:{},children:[{type:a,value:aY}]},{type:a,value:aZ}]},{type:b,tag:c,props:{},children:[{type:a,value:a_},{type:b,tag:f,props:{},children:[{type:a,value:a$}]},{type:a,value:ba}]},{type:b,tag:m,props:{id:t},children:[{type:a,value:t}]},{type:b,tag:c,props:{},children:[{type:a,value:bb},{type:b,tag:d,props:{href:M,rel:[e]},children:[{type:a,value:bc}]},{type:a,value:bd}]},{type:b,tag:c,props:{},children:[{type:a,value:be},{type:b,tag:f,props:{},children:[{type:a,value:bf}]},{type:a,value:bg}]},{type:b,tag:g,props:{code:ac},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"# config\u002Finitializers\u002Fmysqlpls.rb\nrequire 'active_record\u002Fconnection_adapters\u002Fabstract_mysql_adapter'\n\nmodule ActiveRecord\n  module ConnectionAdapters\n    class AbstractMysqlAdapter\n      NATIVE_DATABASE_TYPES[:string] = { :name =\u003E \"varchar\", :limit =\u003E 191 }\n    end\n  end\nend"}]}]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bh},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bi}]},{type:b,tag:g,props:{code:ad},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"NATIVE_DATABASE_TYPES = {\n  primary_key: \"int auto_increment PRIMARY KEY\",\n  string:      { name: \"varchar\", limit: 255 },\n  text:        { name: \"text\" },\n  integer:     { name: \"int\", limit: 4 },\n  float:       { name: \"float\" },\n  decimal:     { name: \"decimal\" },\n  datetime:    { name: \"datetime\" },\n  time:        { name: \"time\" },\n  date:        { name: \"date\" },\n  binary:      { name: \"blob\" },\n  boolean:     { name: \"tinyint\", limit: 1 },\n  json:        { name: \"json\" },\n}"}]}]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bj},{type:b,tag:bk,props:{},children:[]},{type:a,value:bl},{type:b,tag:d,props:{href:bm,rel:[e]},children:[{type:a,value:bn}]},{type:a,value:bo}]},{type:b,tag:m,props:{id:u},children:[{type:a,value:u}]},{type:b,tag:c,props:{},children:[{type:a,value:bp},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bq}]},{type:b,tag:c,props:{},children:[{type:a,value:br},{type:b,tag:f,props:{},children:[{type:a,value:A}]},{type:a,value:bs},{type:b,tag:d,props:{href:bt,rel:[e]},children:[{type:a,value:bu}]},{type:a,value:B}]},{type:b,tag:k,props:{id:ae},children:[{type:a,value:af}]},{type:b,tag:c,props:{},children:[{type:a,value:bv}]},{type:b,tag:m,props:{id:ag},children:[{type:a,value:s}]},{type:b,tag:c,props:{},children:[{type:a,value:bw},{type:b,tag:f,props:{},children:[{type:a,value:bx}]},{type:a,value:by}]},{type:b,tag:c,props:{},children:[{type:a,value:bz}]},{type:b,tag:m,props:{id:ah},children:[{type:a,value:t}]},{type:b,tag:c,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:bA}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bB},{type:b,tag:f,props:{},children:[{type:a,value:bC}]},{type:a,value:bD}]},{type:b,tag:g,props:{code:ai},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"[mysqld]\ninnodb_file_format = Barracuda\ninnodb_file_per_table = 1\ninnodb_large_prefix"}]}]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:bE},{type:b,tag:d,props:{href:bF,rel:[e]},children:[{type:a,value:bG}]},{type:a,value:bH}]},{type:b,tag:F,props:{id:bI},children:[{type:a,value:bJ}]},{type:b,tag:c,props:{},children:[{type:a,value:bK},{type:b,tag:f,props:{},children:[{type:a,value:bL}]},{type:a,value:bM},{type:b,tag:f,props:{},children:[{type:a,value:bN}]},{type:a,value:bO}]},{type:b,tag:g,props:{code:aj},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"create_table :table_name, options: 'ROW_FORMAT=DYNAMIC' do |t|\n  ..."}]}]}]}]}]},{type:b,tag:F,props:{id:bP},children:[{type:a,value:bQ}]},{type:b,tag:c,props:{},children:[{type:a,value:bR}]},{type:b,tag:c,props:{},children:[{type:a,value:bS},{type:b,tag:f,props:{},children:[{type:a,value:bT}]},{type:a,value:bU}]},{type:b,tag:g,props:{code:ak},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:b,tag:n,props:{class:C},children:[{type:b,tag:n,props:{},children:[{type:a,value:"ActiveSupport.on_load :active_record do\n  module ActiveRecord::ConnectionAdapters   \n    class AbstractMysqlAdapter \n      def create_table_with_innodb_row_format(table_name, options = {}) \n        table_options = options.reverse_merge(:options =\u003E 'ENGINE=InnoDB ROW_FORMAT=DYNAMIC')\n\n        create_table_without_innodb_row_format(table_name, table_options) do |td|\n         yield td if block_given? \n        end\n      end\n      alias_method_chain :create_table, :innodb_row_format \n    end\n  end\nend"}]}]}]}]}]},{type:b,tag:m,props:{id:al},children:[{type:a,value:u}]},{type:b,tag:c,props:{},children:[{type:a,value:bV}]},{type:b,tag:k,props:{id:v},children:[{type:a,value:v}]},{type:b,tag:c,props:{},children:[{type:a,value:bW}]},{type:b,tag:k,props:{id:am},children:[{type:a,value:an}]},{type:b,tag:c,props:{},children:[{type:a,value:bX}]},{type:b,tag:c,props:{},children:[{type:a,value:bY}]},{type:b,tag:m,props:{id:ao},children:[{type:a,value:ap}]},{type:b,tag:c,props:{},children:[{type:a,value:bZ},{type:b,tag:d,props:{href:b_,rel:[e]},children:[{type:a,value:N}]},{type:a,value:B}]},{type:b,tag:c,props:{},children:[{type:a,value:b$}]},{type:b,tag:F,props:{id:ca},children:[{type:a,value:cb}]},{type:b,tag:c,props:{},children:[{type:a,value:cc}]},{type:b,tag:c,props:{},children:[{type:a,value:cd},{type:b,tag:d,props:{href:ce,rel:[e]},children:[{type:a,value:O}]}]},{type:b,tag:k,props:{id:G},children:[{type:a,value:G}]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:M,rel:[e]},children:[{type:a,value:cf}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:cg,rel:[e]},children:[{type:a,value:ch}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:ci,rel:[e]},children:[{type:a,value:cj}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:ck,rel:[e]},children:[{type:a,value:cl}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:cm,rel:[e]},children:[{type:a,value:cn}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{href:co,rel:[e]},children:[{type:a,value:cp}]}]}]},{type:b,tag:P,props:{},children:[]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:cq},{type:b,tag:f,props:{},children:[{type:a,value:cr}]},{type:a,value:cs},{type:b,tag:f,props:{},children:[{type:a,value:ct}]},{type:a,value:cu},{type:b,tag:d,props:{href:cv,rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]},{type:b,tag:h,props:{},children:[{type:a,value:cw},{type:b,tag:d,props:{href:cx,rel:[e]},children:[{type:a,value:cy}]},{type:a,value:cz},{type:b,tag:d,props:{href:cA,rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]}]}],toc:{title:i,searchDepth:y,depth:y,links:[{id:Y,depth:y,text:Z},{id:_,depth:y,text:$},{id:aa,depth:y,text:ab,children:[{id:s,depth:D,text:s},{id:t,depth:D,text:t},{id:u,depth:D,text:u}]},{id:ae,depth:y,text:af,children:[{id:ag,depth:D,text:s},{id:ah,depth:D,text:t},{id:al,depth:D,text:u}]},{id:v,depth:y,text:v},{id:am,depth:y,text:an,children:[{id:ao,depth:D,text:ap}]},{id:G,depth:y,text:G}]}},_type:ar,_id:"garden:legacy-articles:2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup.md",_source:as,_file:"legacy-articles\u002F2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup.md",_extension:at,layout:"default"}},"$sdd-surrounds":{"/legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup":[{_path:cC,_dir:T,_draft:l,_partial:l,_locale:U,_empty:l,title:au,description:i,excerpt:{type:K,children:[{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F",rel:[e]},children:[{type:a,value:"從 Jekyll 遷移至 WordPress - 深藏若虛"}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"。這段時間雖然沒發文，卻也是有在做部落格的更新，主軸就如標題所述，將部落格的系統從靜態網站產生器的 Jekyll 移至 WordPress。原因就如"},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fpermalink.php?story_fbid=1717797918453517&id=100006699756364",rel:[e]},children:[{type:a,value:"去年 12 月的 Facebook 貼文"}]},{type:a,value:"所述，主要是圖片管理不易。雖然 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fxdite",rel:[e]},children:[{type:a,value:"XDite"}]},{type:a,value:" 創辦的 "},{type:b,tag:d,props:{href:cD,rel:[e]},children:[{type:a,value:cE}]},{type:a,value:" 的確在這部分做得很好，但 "},{type:b,tag:d,props:{href:cD,rel:[e]},children:[{type:a,value:cE}]},{type:a,value:" 也如創辦人自己所述是疏於經營的，讓我對他的信心不高XD。"},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fwake.gs",rel:[e]},children:[{type:a,value:"Wake"}]},{type:a,value:" 推薦的方式挺有趣，但最近實在沒時間投入一個成熟度不高且又要多項服務自己整合的方式 Orz。所以決定還是回到以前碰過 WordPress 作為部落格的基底。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"對於部落格系統、服務使用歷程大概是："}]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"Pixnet"}]},{type:b,tag:h,props:{},children:[{type:a,value:"Blogger"}]},{type:b,tag:h,props:{},children:[{type:a,value:"WordPress + VPS"}]},{type:b,tag:h,props:{},children:[{type:a,value:"Octpress + Github"}]},{type:b,tag:h,props:{},children:[{type:a,value:"Jekyll + Github"}]},{type:b,tag:h,props:{},children:[{type:a,value:"WordPress + Docker on VPS"}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"繞了一圈，還是回到 WordPress，這個結果也是挺讓人啼笑皆非的。不過這些年來 WordPress 的確是也變滿多的，介面上、客製化、外掛數量等。而且有了 Docker 後，在架設與部署上對環境的規劃時間也減少了，耗費了一段時間去重新投入這塊，本篇主要就是在講述從 Jekyll 遷移到 WordPress 的歷程，包括了主題客製化（Theme Customize）的開發、漢字標準格式的整合、外掛（Plugin）、環境部署與架設幾個部分。"}]},{type:b,tag:q,props:{id:cF},children:[{type:a,value:cF}]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:cG}]},{type:b,tag:h,props:{},children:[{type:a,value:"主題客製化"}]},{type:b,tag:h,props:{},children:[{type:a,value:Q}]},{type:b,tag:h,props:{},children:[{type:a,value:cH},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:cI}]},{type:b,tag:h,props:{},children:[{type:a,value:av}]},{type:b,tag:h,props:{},children:[{type:a,value:cJ}]}]}]},{type:b,tag:h,props:{},children:[{type:a,value:aw}]},{type:b,tag:h,props:{},children:[{type:a,value:v}]}]},{type:b,tag:k,props:{id:"wordpress-的改變"},children:[{type:a,value:cG}]},{type:b,tag:c,props:{},children:[{type:a,value:"這裡的改變不是指 WordPress 近年改變的觀察，畢竟是我沒有一直關注這個社群，而是指自己很久以前接觸 WordPress 到現在重新接觸後，感受變化特別多的部分。但其實我也久沒使用 WordPress 了，有種我是在使用一個新的 CMS 的感覺XD。也聽說最近幾年 WordPress 已從一個 Blog System 演化成一個成熟的 CMS 了呢。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"最直觀的改變大概就是管理後台的介面吧。會想從靜態網站產生器換到 WordPress 無非就是希望管理上能更加簡易、直觀和自動，有一個簡潔、美觀的後台的確是挺對我的胃口的。值得一提的是 WordPress 的後台也有支援 RWD 的瀏覽，或許之後可以用平板做簡單的管理。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-15-下午8.12.13.png]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"另一個比較友善的部分，系統、外掛與主題若有更新，後台都會提醒你，讓你手動去更新。說是手動，事實上也就是一鍵更新，不用其他的操作XD，雖然很多人都說 WordPress 可能資安漏洞比較多，但是有發現的漏洞官方應該都會迅速更新補上，並提醒使用者可更新，我覺得至少減輕了在資安上的不少疑慮。當然，若要和靜態網站產生器的部落格比起來，是不可能沒有漏洞的，這部分就看個人的平衡點和抉擇了。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-15-下午8.19.48.png]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"在 WordPress 進階功能的補足上，官方也有推出一個外掛叫做 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fwordpress.org\u002Fplugins\u002Fjetpack\u002F",rel:[e]},children:[{type:a,value:"Jetpack"}]},{type:a,value:"，一次幫你補充滿多後台的功能。在寫作與閱讀上，比較讓我注重的就是有"},{type:b,tag:d,props:{href:"https:\u002F\u002Fen.support.wordpress.com\u002Fmarkdown-quick-reference\u002F",rel:[e]},children:[{type:a,value:"提供 Markdown 語法的支援"}]},{type:a,value:"（對，就算換到 WordPress 我還是離不開 Markdown。 XD)，以及能使用 Latex 語法去加入較美觀的數學式，再來就是也有提供許多媒體或社交網站的 Shortcode Embeds，讓內嵌 Facebook 的發文、Instgram 的照片、Youtube 的影片、SlideShare 的簡報更加的方便。這些寫作上的方便性也算是拉近了 WordPress 與 Logdown 的差異，也算是我願意回到 WordPress 的原因之一。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"比較可惜的是，儘管在寫作上多了不少進階功能，甚至提供了 Markdown 語法，但在程式設計師最關注的程式碼上色仍沒有實作。"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fn-259-1",rel:[e]},children:[{type:a,value:N}]},{type:a,value:"雖然能理解這不是一般使用者的必備需求，但是多少還是有點遺憾。不過還好在 WordPress 社群中已經有不少程式碼上色的外掛創作，我會在後面的章節提到我是如何實作這個需求。"}]},{type:b,tag:k,props:{id:"主題客製化theme-customize"},children:[{type:a,value:"主題客製化（Theme Customize）"}]},{type:b,tag:c,props:{},children:[{type:a,value:"一開始要投入這塊時，在網路上一直找不到一個有系統的整裡，直接去去看官網的文件，也比較偏向工具書，沒辦法以比較快速的途徑帶過整體概念。所幸後來找到了 "},{type:b,tag:d,props:{href:"http:\u002F\u002Ffundesigner.net\u002F",rel:[e]},children:[{type:a,value:"FunDesigner"}]},{type:a,value:" 提供的 "},{type:b,tag:d,props:{href:"http:\u002F\u002Ffundesigner.net\u002Fwordpress-theme-development-guide\u002F",rel:[e]},children:[{type:a,value:"免費 WORDPRESS 佈景主題開發指南電子書"}]},{type:a,value:"，讓我得以把整體概念暸解一遍，再透過"},{type:b,tag:d,props:{href:"https:\u002F\u002Fcodex.wordpress.org\u002FFunction_Reference",rel:[e]},children:[{type:a,value:"官方的文件"}]},{type:a,value:"做比較細節的暸解，總算將在 Jekyll 已經有基礎的前端設計移植過來了。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"早在使用 Jekyll 時，我已經針對自己偏好的風格去做部落格主題的實作，要移植過來主要就是將 Jekyll 的語法轉換成 WordPress 提供的 PHP 函式。這部分如上述，透過該電子書以及官方文件一一完成移植了。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"不過因為原本的設計仍有許多地方要加強，尤其是後面 Sass 的程式碼凌亂不堪，所以也順勢重新整理，並加上原本缺乏的 RWD，開始做比較細節的改動，讓部落格在手機、平板、電腦上都能有比較良好的瀏覽體驗。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"我將這個主題命名為 Modest，即為"},{type:b,tag:p,props:{},children:[{type:a,value:"謙虛的"}]},{type:a,value:"意思，與部落格名稱相呼應，希望讓讀者感受的風格是比較平淡無華，但在內容瀏覽上是舒適的。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"這部分唯一遇到的問題大概就是由於我不是公開的主題，每次有修改後都要重新上傳，導致一些主題的客製化欄位資料遺失。後來改用 Docekr 將這部分的程式 Volume 到伺服器上，再透過 Git 去做更新，就算是改善了這個問題，這部分的實作我也會後面提到。"}]},{type:b,tag:k,props:{id:Q},children:[{type:a,value:Q}]},{type:b,tag:c,props:{},children:[{type:a,value:"既然是一個注重內容以及其瀏覽舒適度為訴求的主題，那對於字體、字型、排版等都會有比較注重的調整，在這部分我使用了"},{type:b,tag:d,props:{href:"https:\u002F\u002Fcss.hanzi.co\u002F",rel:[e]},children:[{type:a,value:Q}]},{type:a,value:"這套前端框架，幫我處理漢字瀏覽上的一些細節調整，包括字型、縮進、強調等，去取代西方的一些不適用在漢字瀏覽的慣例。細節可以到官方使用手冊瀏覽。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"比較有趣的是該框架還有提供高級排版功能，我啟用了"},{type:b,tag:p,props:{},children:[{type:a,value:"章節的編排"}]},{type:a,value:"這個功能，讓框架自動幫我在標題加上計數，以方便讀者瞭解文章的結構。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"不過有一個比較令我猶豫的地方在於該框架對於標點符號樣式的修正。該框架對於"},{type:b,tag:p,props:{},children:[{type:a,value:"句點"}]},{type:a,value:J},{type:b,tag:p,props:{},children:[{type:a,value:"逗號"}]},{type:a,value:J},{type:b,tag:p,props:{},children:[{type:a,value:"頓號"}]},{type:a,value:"採用的字型是使其偏下，而不是台灣教育部規定的居中，這讓我挺不習慣的。所以在這裡我試圖尋找一些歷史沿革以及實際上的比較。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"我在中國的知乎網站上找的一篇名為"},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.zhihu.com\u002Fquestion\u002F19646540",rel:[e]},children:[{type:a,value:"〈中国的文言文为什么没有标点符号？〉"}]},{type:a,value:"的討論串，裡面最高評分的解答去搜集了許多古籍資料做考證，讓我了解到在古文中標點符號的形式與沿革。不過重點是在於幾乎所有的句讀都是偏右的形式做排版（古文多以直書做書寫排版），換成現代網頁排版形式，也就是偏下。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"之後我又透過變數設定分別使用同一篇文章去比較這兩種排版在閱讀上的感受差異，如下圖："}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-15-上午12.02.29.jpg]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-15-上午12.02.43.jpg]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"雖然還是覺得比較習慣居中的排版方式，但是撇除習慣，偏下的排版方式，在閱讀上能將句子斷的更明顯，閱讀上更加容易，所以最後還是決定採用偏下的排版方式。不過倒也想知道讀者的感覺，你們覺得是採居中的方式比較好閱讀呢？還是偏下呢？若可以，透過留言讓我知道吧。"}]},{type:b,tag:k,props:{id:"外掛plugin"},children:[{type:a,value:cH}]},{type:b,tag:c,props:{},children:[{type:a,value:"因為才剛從 Jekyll 移植過來，所以安裝的外掛到不會太多，畢竟原本的環境就偏向簡單，所以也不太會有額外的需求，另一方面也是讓部落格的系統盡量簡化。會安裝外掛的主要就是針對三大需求：Markdown 語法支援、程式碼上色、部落個資料備份。所以我也就只安裝三個外掛，在這邊我會針對這三個外掛做些簡介。"}]},{type:b,tag:m,props:{id:"jetpack-由-wordpresscom-團隊開發"},children:[{type:a,value:cI}]},{type:b,tag:c,props:{},children:[{type:a,value:"這個外掛在前面已經有約略提過了，在目前 "},{type:b,tag:f,props:{},children:[{type:a,value:"3.9.1"}]},{type:a,value:" 的版本裡提供了 37 項服務，多數服務都挺實用的，尤其是 Markdown 語法的支援還算完整（可惜沒有辦法自行擴充或調整）。當然，除了前面提過的在寫作上的支援外，也有針對安全性去封鎖惡意 IP 的服務、監聽網站是否離線的服務、減輕主機負擔的圖片快取服務等等，有興趣的可以自行安裝該外掛去查看。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-16-下午7.06.42.png]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"另外他也有簡單的網誌統計功能，讓你簡單直觀了解訪客流量的統計，這一方面也算是解決了我一項使用 Jekyll 的苦惱，讓我不用每次想看訪客資料都要到 Google Analysis，而可以先透過這邊的統計去了解。有想要比較深入的報表再去閱讀 Google Analysis 的資料即可。"}]},{type:b,tag:m,props:{id:"crayon-syntax-highlighter"},children:[{type:a,value:av}]},{type:b,tag:c,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"2016-09-22: 本站已改用 highlight.js 作為著色工具，可以參照 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F2016\u002F09\u002F22\u002Ffrom-crayon-to-highlightjs\u002F",rel:[e]},children:[{type:a,value:cK}]},{type:a,value:B}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"身為一個程式設計師，怎麼可以忍受部落格的程式碼沒有上色呢？不能嘛！XD"}]},{type:b,tag:c,props:{},children:[{type:a,value:"於是我在 WordPress 的外掛以"},{type:b,tag:f,props:{},children:[{type:a,value:"Syntax Highlight"}]},{type:a,value:"為關鍵字去尋找，最後選定了目前活躍安裝度最高的 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fwordpress.org\u002Fplugins\u002Fcrayon-syntax-highlighter\u002F",rel:[e]},children:[{type:a,value:av}]},{type:a,value:"。這款外掛的優點是彈性選項多，你可以針對目前的需求去做功能的勾選，另外他也能針對程式碼上色去選擇你喜歡的風格，甚至基於該風格再另外做客製化修正。而最重要的語言支援度上，它支援了 63 種語言，其中包括我常用的 C#, CSS, Java, JavaScript, PHP, Python, Ruby, Sass, Shell, YAML 等，最近比較出名的 Go, Swift 也有納入支援。有興趣進一步知道它支援哪些上色風格和語言的可以到他的 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Faramk\u002Fcrayon-syntax-highlighter",rel:[e]},children:[{type:a,value:"Github Ropository"}]},{type:a,value:" 做瀏覽。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"不過儘管 Crayon 提供許多彈性的設定，但對我來說仍然有些地方不足。比如說他會直接把 "},{type:b,tag:f,props:{},children:[{type:a,value:R}]},{type:a,value:" 標籤轉換成自己的標籤以提供上色服務，但是他的上色的預設風格（例如純文字的環境）又有奇怪的上色，當我希望能提供單一色調 "},{type:b,tag:f,props:{},children:[{type:a,value:R}]},{type:a,value:" 時就會衝突。所以我將他的 Paser 說了點變化，讓它只會抓取有 "},{type:b,tag:f,props:{},children:[{type:a,value:"crayon"}]},{type:a,value:" 屬性並以其結尾的 "},{type:b,tag:f,props:{},children:[{type:a,value:R}]},{type:a,value:" 標籤，像是這樣 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003Cpre class=\"...\" crayon\u003E...\u003C\u002Fpre\u003E"}]},{type:a,value:"，這樣我就可以讓一般的 "},{type:b,tag:f,props:{},children:[{type:a,value:R}]},{type:a,value:" 標籤和給 Crayon 上色的部分共存了。"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fn-259-2",rel:[e]},children:[{type:a,value:O}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"修改方式很簡單，使用外掛編輯器打開 "},{type:b,tag:f,props:{},children:[{type:a,value:ax}]},{type:a,value:" 這份檔案，如下所述修改 "},{type:b,tag:f,props:{},children:[{type:a,value:cL}]},{type:a,value:" 的內容即可。"}]},{type:b,tag:g,props:{code:cM},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:cM}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"另外，我也希望能整合 Markdown 語法去支援類似 "},{type:b,tag:f,props:{},children:[{type:a,value:cN}]},{type:a,value:" 的語法，但是 Jetpack 提供的 Markdown 會自動將這種用法將 "},{type:b,tag:f,props:{},children:[{type:a,value:"~~~"}]},{type:a,value:cO},{type:b,tag:f,props:{},children:[{type:a,value:"\u003Cpre\u003E\u003Ccode\u003E"}]},{type:a,value:" 、將 "},{type:b,tag:f,props:{},children:[{type:a,value:cN}]},{type:a,value:cO},{type:b,tag:f,props:{},children:[{type:a,value:"\u003Cpre\u003E\u003Ccode class=\"php\"\u003E"}]},{type:a,value:" ，而不是 Crayon 可以 Parse 的語法。所以我做了以下修改。首先一樣修改 "},{type:b,tag:f,props:{},children:[{type:a,value:ax}]},{type:a,value:"的 "},{type:b,tag:f,props:{},children:[{type:a,value:cL}]},{type:a,value:" 方法，在剛剛修改的 "},{type:b,tag:f,props:{},children:[{type:a,value:"if"}]},{type:a,value:" 判斷是裡新增一行去抓取 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003Cpre\u003E\u003Ccode class=\"php\"\u003E...\u003C\u002Fcode \u003E\u003C\u002Fpre\u003E"}]},{type:a,value:cP},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fn-259-3",rel:[e]},children:[{type:a,value:cQ}]},{type:a,value:" 的敘述改成 Crayon 可以讀取的格式，如下："}]},{type:b,tag:g,props:{code:cR},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:cR}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"然後在 "},{type:b,tag:f,props:{},children:[{type:a,value:ax}]},{type:a,value:" 的 "},{type:b,tag:f,props:{},children:[{type:a,value:"class CrayonWP {}"}]},{type:a,value:" 中加入一個靜態方法："}]},{type:b,tag:g,props:{code:cS},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:cS}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"如此就可以成功支援 "},{type:b,tag:f,props:{},children:[{type:a,value:"~~~language"}]},{type:a,value:" 的語法了。"}]},{type:b,tag:m,props:{id:"updraftplus-backuprestore"},children:[{type:a,value:cJ}]},{type:b,tag:c,props:{},children:[{type:a,value:"這是用來作為備份和還原的外掛，這部分就見仁見智了，你可使用 Jetpack 提供的付費備份還原服務，也可以使用其他比較知名的外掛，以關鍵字 "},{type:b,tag:f,props:{},children:[{type:a,value:"Backup"}]},{type:a,value:" 去搜尋就會找到挺多的。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-16-下午11.59.22.png]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"本部落格一樣是採用目前活躍安裝度最高的外掛，叫做 UpdraftPlus Backup\u002FRestore，他擁有我需要的基本功能如最基本的備份和還原、還有定期備份、將備份檔同步到雲端空間，基本上我只要有這三個就足以滿足我的需求了。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-17-上午12.03.42.png]]"}]},{type:b,tag:c,props:{},children:[{type:a,value:"另外我也針對備份做了雙保險，就是利用 Docker 將 WordPress 存放的資料的 "},{type:b,tag:f,props:{},children:[{type:a,value:"wp-content"}]},{type:a,value:" 以及 MariaDB 的資料庫檔案 Volume 出來，然後再透過排程去執行腳本，定期將這兩個資料夾壓縮備份到 Nas 上，這部分我會在下一個章節細述。"}]},{type:b,tag:k,props:{id:aw},children:[{type:a,value:aw}]},{type:b,tag:c,props:{},children:[{type:a,value:"自從會使用 Docker 後，要架設一個服務我都會率先尋找是否已經有相關映像檔（Image），以節省安裝環境與架設服務的時間。Wordpress 身為知名的部落格系統，官方很早就有提供其映像檔，詳細資訊可看 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fhub.docker.com\u002F_\u002Fwordpress\u002F",rel:[e]},children:[{type:a,value:"WordPress 在 Docker Hub 的頁面"}]},{type:a,value:B}]},{type:b,tag:c,props:{},children:[{type:a,value:"而隨著 Docker Compose 逐漸普遍與成熟，官方也有提供 "},{type:b,tag:f,props:{},children:[{type:a,value:ay}]},{type:a,value:" 的設定樣本給使用者，事實上該設定檔已足以讓我架設 WordPress。但為了開發方便以及避免不小心把容器砍掉導致資料消逝，或是未來升級版本更加方便，我都會習慣把"},{type:b,tag:p,props:{},children:[{type:a,value:"資料"}]},{type:a,value:"所在資料夾做 Volume，讓其資料與 Host 上同步。在新增 Volumes 的設定後，我的 "},{type:b,tag:f,props:{},children:[{type:a,value:ay}]},{type:a,value:" 設定檔如下："}]},{type:b,tag:g,props:{code:cT},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:cT}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"幸運的是，這些映像檔都有針對這部份做最佳化，你不用擔心在 Host 上無資料，因而將空資料夾取代掉容器中原本有檔案的資料夾，導致容器建立失敗。Wordpress 的映像檔會先建立容器後，再把 WordPress 的程式檔案丟到 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u002Fvar\u002Fwww\u002Fhtml\u002F"}]},{type:a,value:" 中以進行安裝。同樣的 MariaDB 的映像檔也有類似的支援。因此儘管一開始沒有資料，仍可直接以此設定檔建立容器。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"所以環境建立與部署很簡單，只要伺服器上有 Docker 和 Docker-Compose 即可。隨後建立一個資料夾，並將上面的設定檔寫在該資料夾下的 "},{type:b,tag:f,props:{},children:[{type:a,value:ay}]},{type:a,value:" 中，最後在該資料夾下輸入指令 "},{type:b,tag:f,props:{},children:[{type:a,value:"docker-compose up"}]},{type:a,value:"，Wordpress 就建立起來啦！"}]},{type:b,tag:c,props:{},children:[{type:a,value:"最後，我們就透過 Host 的命令列，移動到 "},{type:b,tag:f,props:{},children:[{type:a,value:"wp-content\u002Fthemes\u002F"}]},{type:a,value:" 資料夾下，使用 git 將自己客製化的主題複製（"},{type:b,tag:f,props:{},children:[{type:a,value:"git clone"}]},{type:a,value:"）到此目錄下，再利用 WordPress 後台的佈景主題頁面去啟用，就成功將我的主題套用在 WordPress 上啦！"}]},{type:b,tag:c,props:{},children:[{type:a,value:"![[螢幕快照-2016-02-17-上午6.06.43.png]]"}]},{type:b,tag:k,props:{id:v},children:[{type:a,value:v}]},{type:b,tag:c,props:{},children:[{type:a,value:"從去年十二月開始有念頭要將部落格從 Jekyll 遷移到 WordPress 上，到實際完成大概經歷了兩個月，實際動工的時間大概就是從農曆新年假期開始的約莫兩週左右。這一週耗費最多時間的大概就是在主題的移植與改進，也趁機弄熟了 WordPress 主題的製作方式，再來大概就是去將程式碼高亮、資料備份等雜事都推上軌道。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"另外耗費許多時間的大概就是將文章轉過來，這部分我就沒有透過程式處理了，畢竟網路上的程式大概都是幫你從 WordPress 轉移到 Jekyll，我這種遷移反而是小眾了，況且文章還不多，比起自己在寫程式或正規表達式，手動轉倒是比較省事。另一方面自己手動轉過來也是為了重新審視自己以前寫的文章，知道未來有空要針對哪些文章做維護，尤其是 Docker 相關的文章，可能過期不少了。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"嘛，耗費不少時間做這件事，希望算有移除以前懶得寫文章的障礙，讓自己能願意再多寫文章充實這個部落個囉。接下來半年算是自己的論文衝刺期，或許也會將蒐集到的資料與想法，局部的放在這個地方作為筆記。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"最後，新的西元年、農曆年，還請大家多多指教。 \u003C(_ _)\u003E"}]},{type:b,tag:P,props:{},children:[]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"雖然 WordPress 官方的 Markdown Quick Reference 有提到是有支援的，但我自行嘗試後是沒有成功上色的，不知道問題是出在哪裡（版本不同、文件過期之類的？）。若是有讀者實驗後是有的，還煩請跟我說一聲，我們再討論交流一下。w "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fnref-259-1",rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]},{type:b,tag:h,props:{},children:[{type:a,value:"另一種方案就是新增一個語言支援（例如取名為 txt），然後不使用任何配色。 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fnref-259-2",rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]},{type:b,tag:h,props:{},children:[{type:a,value:"在寫這邊文章時，發現 Jetpack Markdown 只要使用到含有 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003C\u002Fcode\u003E"}]},{type:a,value:" 的 code 語法時就會 Parser 錯誤，如 "},{type:b,tag:f,props:{},children:[{type:a,value:"...\u003C\u002Fcode\u003E..."}]},{type:a,value:" 。但若中間有加空格如 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003C\u002F code\u003E"}]},{type:a,value:cU},{type:b,tag:f,props:{},children:[{type:a,value:"\u003C\u002Fcode \u003E"}]},{type:a,value:" 就沒事，所以在這裡我們才這樣表示。在註解裡則是裡用 Markdown 可以使用 HTML Tag，且 Parser 不會去解析 HTML Tag 中的文字的特性，使用 "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003Ccode\u003E&lt;\u002Fcode&gt;\u003C\u002Fcode\u003E"}]},{type:a,value:" 這種較難維護的語法做表示。 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F259\u002F#fnref-259-3",rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]}]}]},title_en:cV,slug:"from-jekyll-to-wordpress",aliases:[au,cV],created_at:"2016-02-15T19:53:14.000Z",published_at:H,updated_at:H,tags:[cW,"jekyll","wordpress"],moc:[aq],_type:ar,_id:"garden:legacy-articles:2016-02-15-from-jekyll-to-wordpress.md",_source:as,_file:"legacy-articles\u002F2016-02-15-from-jekyll-to-wordpress.md",_extension:at},{_path:cX,_dir:T,_draft:l,_partial:l,_locale:U,_empty:l,title:az,description:i,excerpt:{type:K,children:[{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F",rel:[e]},children:[{type:a,value:"Tr: 在 Docker Container 裡應該避免的 10 件事 - 深藏若虛"}]}]},{type:b,tag:k,props:{id:cY},children:[{type:a,value:cY}]},{type:b,tag:c,props:{},children:[{type:a,value:"本篇文章譯自 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Frafabene",rel:[e]},children:[{type:a,value:"Rafael Benevides"}]},{type:a,value:" 在 2016\u002F02\u002F24 於 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fdeveloperblog.redhat.com\u002F",rel:[e]},children:[{type:a,value:"RED HAT DEVELOPER BLOG"}]},{type:a,value:" 上發表的 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fdeveloperblog.redhat.com\u002F2016\u002F02\u002F24\u002F10-things-to-avoid-in-docker-containers\u002F",rel:[e]},children:[{type:a,value:aA}]},{type:a,value:" 一文。已寫信徵得原作者得同意以進行翻譯。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"希望能透過本篇翻譯，讓臺灣社群對於 Docker container 的使用與理解有所幫助。 = )"}]},{type:b,tag:k,props:{id:cZ},children:[{type:a,value:cZ}]},{type:b,tag:c,props:{},children:[{type:a,value:"嘿，看來您終於也投入 Container（譯註：本文若沒特別說明，Container 皆是指 Docker container）"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-1",rel:[e]},children:[{type:a,value:N}]},{type:a,value:" 的懷抱了，相信您也發現它能夠解決很多問題並擁有很多優點："}]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"不可變的（immutable）："},{type:b,tag:aB,props:{},children:[]},{type:a,value:"\n因為作業系統、函式庫（library）版本、設定、資料夾、應用程式都被包裝在 Container 裡頭，所以您能確保相同的 Image（譯註：本文若沒特別說明，Image 皆是指 Docker image）"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-2",rel:[e]},children:[{type:a,value:O}]},{type:a,value:"，在 QA 的測試下與正式環境中，都會擁有同樣的行為。"}]},{type:b,tag:h,props:{},children:[{type:a,value:"輕量的："},{type:b,tag:aB,props:{},children:[]},{type:a,value:"\nContainer 只使用少量的記憶體。不再需要耗費成千上百 MB 的記憶體，Container 只會使用主程序所需的用量，再多加上數十 MB 的記憶體而已。"}]},{type:b,tag:h,props:{},children:[{type:a,value:"快速的："},{type:b,tag:aB,props:{},children:[]},{type:a,value:"\n您可以啟動 Container 就像是平時啟動 Linux 程序一樣快。不再需要耗費數分鐘，您可以在幾秒內就啟動一個全新的 Container 。"}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"然而，很多使用者仍然對待 Container 像是以往對待虛擬機器一般，認為虛擬化技術該有的優點 Container 都沒落下，卻忘記了 Container 除此之外的另一個絕大優勢："},{type:b,tag:p,props:{},children:[{type:a,value:"它是一次性的（disposable）。"}]}]},{type:b,tag:"blockquote",props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:"Container 的使用哲學：「容器用於一時」"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-3",rel:[e]},children:[{type:a,value:cQ}]}]},{type:b,tag:c,props:{},children:[{type:b,tag:d,props:{href:c_,rel:[e]},children:[{type:b,tag:o,props:{alt:"Containers are ephemeral",src:c_},children:[]}]}]}]},{type:b,tag:c,props:{},children:[{type:a,value:"這個特性「本身」促使使用者改變他們對於處理與管理 Container 的習慣。接下來我會解釋您不應在 Container 裡做什麼，以確保它能發揮最大效益。"}]},{type:b,tag:q,props:{id:"一不要在-container-裡儲存資料data"},children:[{type:a,value:"一、不要在 Container 裡儲存資料（data）"}]},{type:b,tag:c,props:{},children:[{type:a,value:"Container 是可以被停止、摧毀、或是取代的。一個運行 1.0 版應用程式的 Container 應該要可以輕易被運行 1.1 版的 Container 輕易地取代，且不會影響或失去任何資料。如果您真的需要儲存資料，請將它存在 volume "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-4",rel:[e]},children:[{type:a,value:"4"}]},{type:a,value:"。不過如果兩個 Container 都對同一個 volume 寫進資料，要注意是否可能造成出錯，並確保您的應用程式是否有設計寫入共同資料的功能。"}]},{type:b,tag:q,props:{id:"二不要將應用程式分兩部份搬移"},children:[{type:a,value:"二、不要將應用程式分兩部份搬移"}]},{type:b,tag:c,props:{},children:[{type:a,value:"如同有些人會將 Container 視為虛擬機器，裡頭的多數人也會傾向認為應該要將應用程式部署在一個運行中的 Container。當您在開發階段這麼做倒無可厚非，因為您可能要持續地部署與除錯。但在持續交付"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-5",rel:[e]},children:[{type:a,value:"5"}]},{type:a,value:"通往 QA 和正式環境的自動化 pipeline 流程裡，您的應用程式應該是 Image 的一部份。記住："},{type:b,tag:p,props:{},children:[{type:a,value:"Container 是不可變的"}]},{type:a,value:B}]},{type:b,tag:q,props:{id:"三不要建立大型的-image"},children:[{type:a,value:"三、不要建立大型的 Image"}]},{type:b,tag:c,props:{},children:[{type:a,value:"一個大型的 Image 只會讓它難以被散佈。確認您是否只放置應用程式\u002F程序所需的檔案和函式庫，不要在建置時安裝多餘的套件或是進行套件更新（像是 "},{type:b,tag:f,props:{},children:[{type:a,value:"yum update"}]},{type:a,value:cU},{type:b,tag:f,props:{},children:[{type:a,value:"apt-get upgrade"}]},{type:a,value:"）"},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fn-311-6",rel:[e]},children:[{type:a,value:"6"}]},{type:a,value:"，這樣會下載過多的檔案加進新的 Image 層。"}]},{type:b,tag:q,props:{id:"四不要使用單層式的-image"},children:[{type:a,value:"四、不要使用單層式的 Image"}]},{type:b,tag:c,props:{},children:[{type:a,value:"為了有效率地使用分層式檔案系統（layered filesystem），請總是為 OS 建置您專屬的 Base Image，然後為"},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Fjboss-dockerfiles\u002Fbase\u002Fblob\u002Fmaster\u002FDockerfile",rel:[e]},children:[{type:a,value:"使用者名稱定義"}]},{type:a,value:J},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Fjboss-dockerfiles\u002Fwildfly\u002Fblob\u002Fmaster\u002FDockerfile",rel:[e]},children:[{type:a,value:"執行時期所需安裝"}]},{type:a,value:"、設定、您的應用程式各獨立建置一層。這會讓您在 Image 的重建和管理更加簡易，並易於散佈。"}]},{type:b,tag:q,props:{id:"五不要用執行中的-container-建立-image"},children:[{type:a,value:"五、不要用執行中的 Container 建立 Image"}]},{type:b,tag:c,props:{},children:[{type:a,value:"以行話來說，就是不要使用 "},{type:b,tag:f,props:{},children:[{type:a,value:"docker commit"}]},{type:a,value:" 去建立 Image。這種方式建立的 Image 是難以重現的，應該要徹底避免。請務必使用 Dockerfile 或時其他可以完全重現的 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Fopenshift\u002Fsource-to-image",rel:[e]},children:[{type:a,value:"S2I（source-to-image）"}]},{type:a,value:"方式去做這件事。另外，若是您使用程式碼版本控制系統（如 git）去儲存 Dockerfile，您就可以追蹤 Dockerfile 的變動。"}]},{type:b,tag:q,props:{id:"六不要只使用latest標籤"},children:[{type:a,value:"六、不要只使用 "},{type:b,tag:f,props:{},children:[{type:a,value:S}]},{type:a,value:" 標籤"}]},{type:b,tag:c,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:S}]},{type:a,value:" 標籤就像是 Maven 使用者的 SNAPSHOT。多使用標籤，以善用分層式檔案系統的特性。您不會希望在您建置 Image 的幾個月後，驚訝的發現您的應用程式竟然不能執行，探究原因後才發現是因為父層級（Dockerfile 中的 "},{type:b,tag:f,props:{},children:[{type:a,value:"FROM"}]},{type:a,value:"）被一個無法向下相容的新版本給取代了，或是因為從建置快取中取得錯誤的 "},{type:b,tag:f,props:{},children:[{type:a,value:S}]},{type:a,value:" 導致。"},{type:b,tag:f,props:{},children:[{type:a,value:S}]},{type:a,value:" 標籤也應該避免使用在正式環境下部署 Container，因為您不能追蹤您的 Container 到底是跑哪一個 Image 版本。"}]},{type:b,tag:q,props:{id:"七不要在一個-container-跑超過一個程序"},children:[{type:a,value:"七、不要在一個 Container 跑超過一個程序"}]},{type:b,tag:c,props:{},children:[{type:a,value:"程序可以完美的去執行一個程序（像是 http daemon、application server、database），但如果您執行超過一個程序，您可能會在管理、讀取紀錄或獨立更新上都感到棘手。"}]},{type:b,tag:q,props:{id:"八不要在-image-儲存憑証請使用環境變數"},children:[{type:a,value:"八、不要在 Image 儲存憑証，請使用環境變數"}]},{type:b,tag:c,props:{},children:[{type:a,value:"不要將您的使用者名稱或是密碼寫死（hard-code）在 Image 中。請使用環境變數從 Container 外面取得這些資訊。像是 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Fdocker-library\u002Fpostgres\u002Fblob\u002F443c7947d548b1c607e06f7a75ca475de7ff3284\u002F9.5\u002Fdocker-entrypoint.sh",rel:[e]},children:[{type:a,value:"Postgres Image"}]},{type:a,value:" 就是一個很好的典範。"}]},{type:b,tag:q,props:{id:"九使用非-root-的使用者去執行程序"},children:[{type:a,value:"九、使用非 root 的使用者去執行程序"}]},{type:b,tag:c,props:{},children:[{type:a,value:"「Docker container 預設會使用 root 去執行程序。….隨著 docker 越來越成熟，會有更多安全的預設設定可以使用。現在，需要用 root 對其他人是有危險的，且可能無法在所有環境中使用。您的 Image 應該使用 USER 指令去指定非 root 的使用者讓 container 執行。….」——"},{type:b,tag:d,props:{href:"http:\u002F\u002Fwww.projectatomic.io\u002Fdocs\u002Fdocker-image-author-guidance\u002F",rel:[e]},children:[{type:a,value:"Guidance for Docker Image Authors"}]}]},{type:b,tag:q,props:{id:"十不要相依-ip-位址"},children:[{type:a,value:"十、不要相依 IP 位址"}]},{type:b,tag:c,props:{},children:[{type:a,value:"每個 Container 都擁有他們自己內部的 IP 位址，並可能會在您啟動或停止 Container 時被改變。如果您的應用程式或是微服務需要跟另一個的 Container 溝通，請利用環境變數將合適的 hostname 和 port 從一個 Container 傳遞給另一個 Container 。"}]},{type:b,tag:c,props:{},children:[{type:a,value:"更多關於 Container 的資訊，請參考並註冊 "},{type:b,tag:d,props:{href:c$,rel:[e]},children:[{type:a,value:c$}]}]},{type:b,tag:c,props:{},children:[{type:b,tag:o,props:{alt:"[]containers",src:"https:\u002F\u002Fi0.wp.com\u002Fblog.fntsr.tw\u002Fwp-content\u002Fuploads\u002F2016\u002F03\u002Fcontainers.png?ssl=1"},children:[]}]},{type:b,tag:k,props:{id:da},children:[{type:a,value:da}]},{type:b,tag:c,props:{},children:[{type:a,value:"深刻體會到讀懂英文與翻譯成中文是兩回事。若有任何覺得翻譯不妥，或是覺得可以更好的建議，歡迎留言告知。最後特別感謝 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fgroups\u002Fdocker.taipei\u002F",rel:[e]},children:[{type:a,value:"Docker.Taipei"}]},{type:a,value:" 社群的先進 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fphilipzh",rel:[e]},children:[{type:a,value:"Philip Zheng"}]},{type:a,value:J},{type:b,tag:d,props:{href:"https:\u002F\u002Fwww.facebook.com\u002Fwilliam.yeh?fref=ufi",rel:[e]},children:[{type:a,value:"William Yeh"}]},{type:a,value:" 及友人 "},{type:b,tag:d,props:{href:"https:\u002F\u002Fgithub.com\u002Fdavid50407",rel:[e]},children:[{type:a,value:"Davy"}]},{type:a,value:J},{type:b,tag:d,props:{href:"http:\u002F\u002Fsaru.moe\u002F",rel:[e]},children:[{type:a,value:"猴子"}]},{type:a,value:"、Micheal、Chorld 提供諮詢與建議。"}]},{type:b,tag:P,props:{},children:[]},{type:b,tag:r,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"Container，中文多翻為容器，本文特別指 Docker container，而非泛指所有 container。考證臺灣社群與相關報導，決定在文本維持英文，並採用原文"},{type:b,tag:db,props:{},children:[{type:a,value:"使用小寫。，且為了與一般容器區隔，刻意使用首字大寫表示其為狹義性。 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fnref-311-1",rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]}]},{type:a,value:cP}]},{type:b,tag:h,props:{},children:[{type:b,tag:db,props:{},children:[{type:a,value:"Image，中文在台灣社群多翻為映像檔，中國社群則為鏡像，本文特別指 Docker image，與虛擬機器的 image 概念不盡相同。考證臺灣社群與相關報導，決定在文本維持英文，並採用原文"}]},{type:a,value:"使用小寫。，且為了與虛擬機器的 image 區隔，刻意使用首字大寫表示其為狹義性。 "},{type:b,tag:d,props:{href:"http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F311\u002F#fnref-311-2",rel:[e]},children:[{type:b,tag:o,props:{alt:w,src:x},children:[]}]},{type:a,value:"~~~~ "}]},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{code:i,filename:aC,language:"ephemeral"},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:i}]}]}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{code:i,filename:aC,language:"volume，在《Docker —— 從入門到實踐­》正體中文版翻作資料卷，在這裡採用原文會比較直觀。 "},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:i}]}]}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{code:i,filename:"山姆鍋對持續整合、持續部署、持續交付的定義](https:\u002F\u002Fsamkuo.me\u002Fpost\u002F2013\u002F10\u002Fcontinuous-integration-deployment-delivery\u002F)，本文就不多描述了。 [![↩](https:\u002F\u002Fs.w.org\u002Fimages\u002Fcore\u002Femoji\u002F14.0.0\u002Fsvg\u002F21a9.svg)",language:"continuous"},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:i}]}]}]}]},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{code:i,filename:aC,language:"因為台灣"},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:i}]}]}]}]}]},{type:b,tag:g,props:{code:i},children:[{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{__ignoreMap:i},children:[{type:a,value:i}]}]}]}]},title_en:aA,slug:"10-things-to-avoid-in-docker-containers",aliases:[az,aA],created_at:"2016-03-06T08:57:50.000Z",published_at:H,updated_at:H,tags:[cW,"translate"],moc:[aq],_type:ar,_id:"garden:legacy-articles:2016-03-06-10-things-to-avoid-in-docker-containers.md",_source:as,_file:"legacy-articles\u002F2016-03-06-10-things-to-avoid-in-docker-containers.md",_extension:at}]},"$sdd-globals":{},"$sdd-navigation":[{title:aD,_path:dc,children:[{title:"Achievements",_path:"\u002Fabout\u002Fachievements",children:[{title:"2013 11 Startup Weekend",_path:"\u002Fabout\u002Fachievements\u002F2013-11-startup-weekend"},{title:"2014 10 Phpconf",_path:"\u002Fabout\u002Fachievements\u002F2014-10-phpconf"},{title:"2014 12 F Secure",_path:"\u002Fabout\u002Fachievements\u002F2014-12-f-secure"},{title:"2015 10 Phpconf",_path:"\u002Fabout\u002Fachievements\u002F2015-10-phpconf"},{title:"2019 01 Ironman",_path:"\u002Fabout\u002Fachievements\u002F2019-01-ironman"}]},{title:"Experiences",_path:"\u002Fabout\u002Fexperiences",children:[{title:"2010 09 NCHU History",_path:"\u002Fabout\u002Fexperiences\u002F2010-09-nchu-history"},{title:"2014 07 Eztable Interns",_path:"\u002Fabout\u002Fexperiences\u002F2014-07-eztable-interns"},{title:"2014 09 Cases",_path:"\u002Fabout\u002Fexperiences\u002F2014-09-cases"},{title:"2014 09 Ncu Software Engineering",_path:"\u002Fabout\u002Fexperiences\u002F2014-09-ncu-software-engineering"},{title:"2017 12 Sharelike ScrumMaster",_path:"\u002Fabout\u002Fexperiences\u002F2017-12-sharelike-scrummaster"},{title:"2019 05 Titansoft ScrumMaster",_path:"\u002Fabout\u002Fexperiences\u002F2019-05-titansoft-scrummaster"}]},{title:aD,_path:dc},{title:aD,_path:"\u002Fabout\u002Fme"},{title:"Portfolios",_path:"\u002Fabout\u002Fportfolios",children:[{title:"Games",_path:"\u002Fabout\u002Fportfolios\u002Fgames",children:[{title:"2013 09 Game Isr2013",_path:"\u002Fabout\u002Fportfolios\u002Fgames\u002F2013-09-game-isr2013"},{title:"2018 03 Game Aoe Mod Sorting",_path:"\u002Fabout\u002Fportfolios\u002Fgames\u002F2018-03-game-aoe-mod-sorting"},{title:"2018 04 Game Aoe Mod English Room Name",_path:"\u002Fabout\u002Fportfolios\u002Fgames\u002F2018-04-game-aoe-mod-english-room-name"}]},{title:"Publications",_path:"\u002Fabout\u002Fportfolios\u002Fpublications",children:[{title:"2017 08 Docker ISBN 9789864764877",_path:"\u002Fabout\u002Fportfolios\u002Fpublications\u002F2017-08-docker-isbn-9789864764877"},{title:"2018 07 TensorFlow ISBN 9789864767946",_path:"\u002Fabout\u002Fportfolios\u002Fpublications\u002F2018-07-tensorflow-isbn-9789864767946"}]},{title:"Software",_path:"\u002Fabout\u002Fportfolios\u002Fsoftware",children:[{title:"2009 01 App Nf Bbs",_path:"\u002Fabout\u002Fportfolios\u002Fsoftware\u002F2009-01-app-nf-bbs"},{title:"2015 01 App Korat",_path:"\u002Fabout\u002Fportfolios\u002Fsoftware\u002F2015-01-app-korat"}]},{title:"Utilities",_path:"\u002Fabout\u002Fportfolios\u002Futilities",children:[{title:"2014 12 Utility Slack Irc Syncbot)",_path:"\u002Fabout\u002Fportfolios\u002Futilities\u002F2014-12-utility-slack-irc-syncbot)"},{title:"2015 04 Utility M2isocket",_path:"\u002Fabout\u002Fportfolios\u002Futilities\u002F2015-04-utility-m2isocket"},{title:"2016 11 Utility Sms Edu",_path:"\u002Fabout\u002Fportfolios\u002Futilities\u002F2016-11-utility-sms-edu"}]},{title:"Web",_path:"\u002Fabout\u002Fportfolios\u002Fweb",children:[{title:"2012 01 Web Nchulib Access Control System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2012-01-web-nchulib-access-control-system"},{title:"2012 01 Web Nchulib Room Booking System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2012-01-web-nchulib-room-booking-system"},{title:"2012 01 Web Nchusg Appeal Management System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2012-01-web-nchusg-appeal-management-system"},{title:"2012 01 Web Nchusg Board Manger System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2012-01-web-nchusg-board-manger-system"},{title:"2012 01 Web Nchusg Official Website",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2012-01-web-nchusg-official-website"},{title:"2013 01 Web Nchulib Book Searching System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2013-01-web-nchulib-book-searching-system"},{title:"2013 01 Web Nchulib Business Statics System",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2013-01-web-nchulib-business-statics-system"},{title:"2015 02 Web Nine Grids Judge",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2015-02-web-nine-grids-judge"},{title:"2015 07 Web Ics 2015 Thesis",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2015-07-web-ics-2015-thesis"},{title:"2016 08 Web Ncyu Life",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2016-08-web-ncyu-life"},{title:"2016 09 Web Morse Code",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2016-09-web-morse-code"},{title:"2016 09 Web Npps 59 607",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2016-09-web-npps-59-607"},{title:"2016 12 Web Meder Book",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2016-12-web-meder-book"},{title:"2018 08 Web Agile Dashboard",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2018-08-web-agile-dashboard"},{title:"2018 12 Web Project 808",_path:"\u002Fabout\u002Fportfolios\u002Fweb\u002F2018-12-web-project-808"}]}]},{title:"Professional",_path:"\u002Fabout\u002Fprofessional"}]},{title:"Announce",_path:"\u002Fannounce",children:[{title:"以 Digital Garden 之貌重新開張！",_path:"\u002Fannounce\u002Fre-opening-as-digital-garden"}]},{title:"Articles",_path:"\u002Farticles",children:[{title:dd,_path:"\u002Farticles\u002F2018-06-02-how-to-describe-a-bug-report"}]},{title:"主頁",_path:de},{title:"Legacy Articles",_path:"\u002Flegacy-articles",children:[{title:"國立中央大學軟體工程研究所推甄心得",_path:"\u002Flegacy-articles\u002F2013-12-04-recommendation-experience-of-master-of-software-engineering"},{title:"我為什麼以及如何使用 Sublime Text 2",_path:"\u002Flegacy-articles\u002F2013-12-15-why-and-how-i-use-sublime-text-2"},{title:"二十四歲生日",_path:"\u002Flegacy-articles\u002F2014-10-16-24-years-old"},{title:"如何用 Docker 部署 PHP 專案",_path:"\u002Flegacy-articles\u002F2014-10-18-how-to-deploy-php-projects-with-docker"},{title:"跨領域學習的挑戰",_path:"\u002Flegacy-articles\u002F2014-10-31-challenge-of-interdisciplinary-learning"},{title:"在 OS X 更新 Docker 和 Boot2docker",_path:"\u002Flegacy-articles\u002F2014-10-31-upgrade-docker-and-boot-2-docker-on-os-x"},{title:"在 OS X 上，透過 boot2docker 使用 docker 的 data volume",_path:"\u002Flegacy-articles\u002F2014-10-31-use-docker-data-volume-on-os-x"},{title:"如何使用 Docker 架設 Discourse",_path:"\u002Flegacy-articles\u002F2014-11-07-how-to-build-discourse-with-docker"},{title:"Docker 無法解析 github.com",_path:"\u002Flegacy-articles\u002F2014-11-08-docker-cant-resolve-github-com"},{title:"來到 2014 年的 12 月，半年回顧",_path:"\u002Flegacy-articles\u002F2014-11-30-december-of-2014"},{title:"讓學生透過 DigitalOcean 嘗試 Docker！",_path:"\u002Flegacy-articles\u002F2014-12-11-let-students-try-docker-at-digtial-ocean"},{title:"Docker 指令示意圖",_path:"\u002Flegacy-articles\u002F2014-12-15-docker-command-diagram"},{title:"2015，上半年",_path:"\u002Flegacy-articles\u002F2015-03-03-first-half-year-of-2015"},{title:"Docker 初探，實驗室中的運貨鯨",_path:"\u002Flegacy-articles\u002F2015-05-28-docker-talks-on-nos-of-ncu"},{title:"運動雲端，雲科大休運所演講",_path:"\u002Flegacy-articles\u002F2015-06-03-clould-talks-at-yun-tech"},{title:"身體狀況報告：20150607",_path:"\u002Flegacy-articles\u002F2015-06-07-health-report-20150607"},{title:"2015 年 6 月到 10 月紀錄",_path:"\u002Flegacy-articles\u002F2015-10-26-from-jun-to-oct-of-2015"},{title:"如何用 Docker 生態系遷移您的專案",_path:"\u002Flegacy-articles\u002F2015-11-01-ship-your-projects-with-docker-ecosystem"},{title:"世紀帝國 II 系列：HD 4.4 Patch 目前已知問題",_path:"\u002Flegacy-articles\u002F2015-11-08-aoe-ii-awful-patch-4-4"},{title:au,_path:cC},{title:V,_path:aF},{title:az,_path:cX},{title:"讓 jQuery 在 webpack 中成為全域變數",_path:"\u002Flegacy-articles\u002F2016-09-13-expose-jquery-to-global-variable-with-webpack"},{title:"十四經脈國際名稱與縮寫",_path:"\u002Flegacy-articles\u002F2016-09-18-name-of-meridian-and-it-s-alphabetic-code"},{title:cK,_path:"\u002Flegacy-articles\u002F2016-09-22-use-highlight-js-to-be-code-highlight-program-to-instead-of-crayon-syntax-highlighter"},{title:"更新 Jetpack 後造成 WordPress 後台出錯的處理方式",_path:"\u002Flegacy-articles\u002F2016-11-30-fatal-error-of-wordpress-dashboard-after-updated-jetpack-plugin"},{title:"獲取 Google Drive, Dropbox, OneDrive 中檔案直接下載的連結",_path:"\u002Flegacy-articles\u002F2016-12-21-generate-google-drive-dropbox-one-drive-directly-download-link"},{title:"駐守學校於下班時間遇不理性訪客處理守則",_path:"\u002Flegacy-articles\u002F2017-01-08-code-of-school-guard-when-meeting-irrational-visitor-on-off-hours-of-school"},{title:"將本站的執行環境更新到最新穩定版",_path:"\u002Flegacy-articles\u002F2017-01-16-upgrade-system-and-php"},{title:"世紀帝國 II 系列：軍營單位翻譯探討",_path:"\u002Flegacy-articles\u002F2017-01-18-aoe-ii-barracks-units-translation"},{title:"世紀帝國 II 系列：時代升級所需時間",_path:"\u002Flegacy-articles\u002F2017-01-23-aoe-ii-time-of-upgrade-ages"},{title:"世紀帝國 II 系列：在翻譯《隨機地圖腳本指南》之前",_path:"\u002Flegacy-articles\u002F2017-01-24-aoe-ii-before-translate-random-map-scripting-guide"},{title:"世紀帝國 II 系列：《隨機地圖腳本指南》緒論",_path:"\u002Flegacy-articles\u002F2017-01-28-aoe-ii-random-map-scripting-guide-introduction"},{title:"在 MacOS X 的 Terminal 中，使用指令開啟 Visual Studio Code",_path:"\u002Flegacy-articles\u002F2017-01-30-run-visual-studio-code-from-terminal-on-mac-os-x"},{title:"正規表達式符號速查表",_path:"\u002Flegacy-articles\u002F2017-02-05-regular-expression-cheatsheet"},{title:"Markdown 表格語法原則",_path:"\u002Flegacy-articles\u002F2017-02-07-principle-of-markdown-table-syntax"},{title:"部落格主題更新",_path:"\u002Flegacy-articles\u002F2017-02-14-update-blog-theme-on-feb-2017"},{title:"世紀帝國 II 系列：各文明名稱翻譯對照表",_path:"\u002Flegacy-articles\u002F2017-03-01-aoe-ii-chinese-translation-of-civilizations"},{title:"世紀帝國 II 系列：通用建築翻譯對照表",_path:"\u002Flegacy-articles\u002F2017-04-16-aoe-ii-chinese-translation-of-common-buildings"},{title:"世紀帝國 II 系列：經濟建築通用單位與科技翻譯對照表",_path:"\u002Flegacy-articles\u002F2017-04-19-aoe-ii-chinese-translation-of-units-and-technology-of-economic-building"},{title:"世紀帝國 II 系列：軍事建築通用單位與科技翻譯對照表",_path:"\u002Flegacy-articles\u002F2017-05-07-aoe-ii-chinese-translation-of-units-and-technology-of-military-building"},{title:"有關 Docker 開源專案改名為 Moby 的相關討論收集",_path:"\u002Flegacy-articles\u002F2017-05-09-collection-about-why-docker-project-rename-to-moby"},{title:"對國中生介紹程式設計師這個職業",_path:"\u002Flegacy-articles\u002F2017-07-07-introduce-the-programmer-for-students-of-junior-high"},{title:"現行 103 課綱所選古文 30 篇原文一覧",_path:"\u002Flegacy-articles\u002F2017-09-07-30-classical-chinese-essays-of-103-course-outline"},{title:"PostgreSQL 與 MySQL 關於 transaction 的設計理念",_path:"\u002Flegacy-articles\u002F2017-09-17-transaction-design-of-postgre-sql-and-my-sql"},{title:"世紀帝國 II 系列：《隨機地圖腳本指南》翻譯說明",_path:"\u002Flegacy-articles\u002F2017-09-24-aoe-ii-annotation-of-random-map-scripting-guide-translation"},{title:"世紀帝國 II 系列：《隨機地圖腳本指南》CH1 語言",_path:"\u002Flegacy-articles\u002F2017-09-25-aoe-ii-rmsg-ch-1-language-reference"},{title:"世紀帝國 II 系列：《隨機地圖腳本指南》CH1.1 腳本參考範本",_path:"\u002Flegacy-articles\u002F2017-09-26-aoe-ii-rmsg-ch-1-1-scheme-of-a-rms"},{title:"世紀帝國 II 系列：各文明特有建築、單位與科技翻譯對照表",_path:"\u002Flegacy-articles\u002F2017-09-27-aoe-ii-chinese-translation-of-unique-units-and-technology-of-civilizations"},{title:"世紀帝國 II 系列：《隨機地圖腳本指南》CH1.2.1 \u003CPLAYER_SETUP\u003E 章節",_path:"\u002Flegacy-articles\u002F2017-09-27-aoe-ii-rmsg-ch-1-2-1-player-setup-section"},{title:"關於我的暱稱",_path:"\u002Flegacy-articles\u002F2017-11-20-about-my-nicknames"},{title:"世紀帝國 II 系列：術語、名詞解釋",_path:"\u002Flegacy-articles\u002F2017-12-05-aoe-ii-terms"},{title:"更改噗浪被標記噗文的樣式",_path:"\u002Flegacy-articles\u002F2017-12-12-change-style-of-marked-plurk"},{title:"茄萣黑色米克斯徵求新主人",_path:"\u002Flegacy-articles\u002F2017-12-13-ka-tiann-black-mix-dog-seeks-new-owner"},{title:"有朋自遠方來，不亦樂乎",_path:"\u002Flegacy-articles\u002F2018-02-08-it-is-such-a-pleasure-to-have-friends-coming-from-afar"},{title:"任職於 Sharelike.Asia",_path:"\u002Flegacy-articles\u002F2018-02-08-working-at-sharelike-asia"},{title:"「淺嚐 Google Venture 的 Design Sprint」工作坊參與心得",_path:"\u002Flegacy-articles\u002F2018-02-11-experience-of-design-sprint-workshop-on-agile-taichung-meetup"},{title:"老羅斯福演講：民主國家的公民權利",_path:"\u002Flegacy-articles\u002F2018-02-19-citizenship-in-a-republic"},{title:"Ex: Scrum 社群的老笑話：雞與豬",_path:"\u002Flegacy-articles\u002F2018-02-19-scrum-joke-chicken-and-pig"},{title:"Fw 敏捷軟體開發宣言",_path:"\u002Flegacy-articles\u002F2018-02-21-manifesto-for-agile-software-development"},{title:"Ex: Scrum 每日立會容易出現的誤解",_path:"\u002Flegacy-articles\u002F2018-02-21-misunderstanding-of-scrum-daily-standing-meeting"},{title:"Fw: 軟體工藝宣言",_path:"\u002Flegacy-articles\u002F2018-02-22-software-craftsmanship-manifesto"},{title:"世紀帝國 II 系列：文明選單分類排序模組",_path:"\u002Flegacy-articles\u002F2018-04-05-aoe-ii-mod-civilizations-sorting-by-dlc"},{title:"世紀帝國 II 系列：將中文介面下預設房間名稱改回英文",_path:"\u002Flegacy-articles\u002F2018-04-05-aoe-ii-mod-english-room-name-in-chinese-ui"},{title:dd,_path:"\u002Flegacy-articles\u002F2018-06-02-how-to-describe-a-bug-report"},{title:"Fw: 敏捷宣言背後的原則",_path:"\u002Flegacy-articles\u002F2018-06-19-principles-behind-the-agile-manifesto"},{title:"第 10 屆 iT 邦幫忙鐵人賽",_path:"\u002Flegacy-articles\u002F2018-10-22-10th-ithome-ironman"},{title:"PChome & Skype 服務資料填寫遇到地址不正確的問題",_path:"\u002Flegacy-articles\u002F2019-03-04-how-to-workaround-addressed-incorrect-issue-when-fill-application-on-pchome-skype-service"},{title:"任職 ScrumMaster @ Titansoft",_path:"\u002Flegacy-articles\u002F2019-05-02-working-as-scrum-master-at-titansoft"},{title:"Scrum 相關事件的時間長度建議",_path:"\u002Flegacy-articles\u002F2019-05-07-suggested-duration-of-scrum-related-events"},{title:"將部落格搬到新的魚缸 (?)",_path:"\u002Flegacy-articles\u002F2020-08-21-migrated-blog-environments"},{title:"第 12 屆 iT 邦幫忙鐵人賽",_path:"\u002Flegacy-articles\u002F2020-09-01-12th-ithome-ironman"},{title:"閱讀《與成功有約：高效能人士的七個習慣》(1) 聯想",_path:"\u002Flegacy-articles\u002F2021-02-12-read-a-date-with-success-the-seven-habits-of-highly-effective-people-1-think"},{title:"避免跑題太久的計時器",_path:"\u002Flegacy-articles\u002F2021-03-14-timers-to-avoid-digressing-for-too-long"},{title:"讀五十六巷七弄的〈淺談 Remote work〉有感",_path:"\u002Flegacy-articles\u002F2021-06-18-after-reading-remote-work-of-mungkeii"},{title:"Slack 溝通指南",_path:"\u002Flegacy-articles\u002F2021-06-18-slack-communication-guide"},{title:"WordPress 的 PHP風格指南摘要",_path:"\u002Flegacy-articles\u002F2021-07-17-php-convention-of-wordpress"},{title:"Windows 安裝指南",_path:"\u002Flegacy-articles\u002F2021-07-22-windows-install-guide"},{title:"《臺灣死亡咖啡館》書摘與讀後感",_path:"\u002Flegacy-articles\u002F2021-07-26-book-excerpt-and-reflections-on-taiwan-death-cafe"},{title:"macOS 風格的 Windows 鍵盤按鍵設定指南",_path:"\u002Flegacy-articles\u002F2021-07-27-windows-shortcut-setting-guide-with-macos-style"},{title:"國文課本選文的重點也可以拿來檢視使用者故事？！",_path:"\u002Flegacy-articles\u002F2021-11-16-selections-principles-of-chinese-textbook-also-can-be-used-to-examine-user-stories"},{title:"面對情緒",_path:"\u002Flegacy-articles\u002F2021-12-05-face-to-emotions"}]},{title:"Notes",_path:"\u002Fnotes",children:[{title:"數位花園",_path:"\u002Fnotes\u002Fdigital-garden"},{title:"內容地圖",_path:"\u002Fnotes\u002Fmap-of-contents"},{title:"卡片盒筆記法",_path:"\u002Fnotes\u002Fzettelkasten"}]},{title:"Sandbox",_path:"\u002Fsandbox",children:[{title:"程式碼渲染示例",_path:"\u002Fsandbox\u002Fcode"},{title:"Markdown 渲染示例",_path:"\u002Fsandbox\u002Fmarkdown"},{title:"Mermaid 渲染示例",_path:"\u002Fsandbox\u002Fmermaid"},{title:"Wiki Link 渲染示例",_path:"\u002Fsandbox\u002Fwikilink"}]}],$sicons:{"mdi:email":{left:z,top:z,width:I,height:I,rotate:z,vFlip:l,hFlip:l,body:"\u003Cpath fill=\"currentColor\" d=\"m20 8l-8 5l-8-5V6l8 5l8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z\"\u002F\u003E"},"mdi:github":{left:z,top:z,width:I,height:I,rotate:z,vFlip:l,hFlip:l,body:"\u003Cpath fill=\"currentColor\" d=\"M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z\"\u002F\u003E"},"mdi:linkedin":{left:z,top:z,width:I,height:I,rotate:z,vFlip:l,hFlip:l,body:"\u003Cpath fill=\"currentColor\" d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77Z\"\u002F\u003E"}}},_errors:{},serverRendered:E,config:{public:{content:{locales:[],integrity:1683602980613,experimental:{stripQueryParameters:l,clientDB:l},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:["layout"]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{preload:["javascript","typescript","vue","vue-html","ruby","mermaid"]},wsUrl:i,documentDriven:{page:E,navigation:E,surround:E,globals:{},layoutFallbacks:["theme"],injectPage:E},anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:de,buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:i}},prerenderedAt:void 0}}("text","element","p","a","nofollow","code-inline","code","li","","pre","h2",false,"h3","span","img","strong","h5","ol","方向","方法","總結","結語","↩","https:\u002F\u002Fs.w.org\u002Fimages\u002Fcore\u002Femoji\u002F14.0.0\u002Fsvg\u002F21a9.svg",2,0,":string","。","line",3,true,"h4","參考資料",null,24,"、","root","https:\u002F\u002Fi0.wp.com\u002Fblog.fntsr.tw\u002Fwp-content\u002Fuploads\u002F2016\u002F02\u002F%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7-2016-02-20-%E4%B8%8A%E5%8D%883.12.53.png?ssl=1","https:\u002F\u002Fgithub.com\u002Frails\u002Frails\u002Fissues\u002F9855","1","2","hr","漢字標準格式","\u003Cpre\u003E","latest","legacy-articles","en","解決 MySQL 使用 utf8mb4 編碼導致 Rails 資料庫遷移失敗的問題","~\u002Fapp $ RAILS_ENV=production rake db:migrate\n\n== 20150226092347 DeviseCreateUsers: migrating================================\n-- create_table(:users)\n   -\u003E 0.0070s\n-- add_index(:users, :email, {:unique=\u003Etrue})\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\nMysql2::Error: Specified key was too long; max key length is 767 bytes: CREATE UNIQUE INDEX `index_users_on_email`  ON `users` (`email`) ~\u002F.rvm\u002Fgems\u002Fruby-2.2.2\u002Fgems\u002Fmysql2-0.4.2\u002Flib\u002Fmysql2\u002Fclient.rb:107:in `_query'\n......\n","Mysql2::Error: Specified key was too long; max key length is 767 bytes\n","什麼時候會採用utf8mb4作為-mysql-的編碼","什麼時候會採用 utf8mb4 作為 MySQL 的編碼？","為什麼-rails-改用utf8mb4編碼就會超過長度呢","為什麼 Rails 改用 utf8mb4 編碼就會超過長度呢？","解決方案-1","解決方案 (1)","# config\u002Finitializers\u002Fmysqlpls.rb\nrequire 'active_record\u002Fconnection_adapters\u002Fabstract_mysql_adapter'\n\nmodule ActiveRecord\n  module ConnectionAdapters\n    class AbstractMysqlAdapter\n      NATIVE_DATABASE_TYPES[:string] = { :name =\u003E \"varchar\", :limit =\u003E 191 }\n    end\n  end\nend\n","NATIVE_DATABASE_TYPES = {\n  primary_key: \"int auto_increment PRIMARY KEY\",\n  string:      { name: \"varchar\", limit: 255 },\n  text:        { name: \"text\" },\n  integer:     { name: \"int\", limit: 4 },\n  float:       { name: \"float\" },\n  decimal:     { name: \"decimal\" },\n  datetime:    { name: \"datetime\" },\n  time:        { name: \"time\" },\n  date:        { name: \"date\" },\n  binary:      { name: \"blob\" },\n  boolean:     { name: \"tinyint\", limit: 1 },\n  json:        { name: \"json\" },\n}\n","解決方案-2","解決方案 (2)","方向-1","方法-1","[mysqld]\ninnodb_file_format = Barracuda\ninnodb_file_per_table = 1\ninnodb_large_prefix\n","create_table :table_name, options: 'ROW_FORMAT=DYNAMIC' do |t|\n  ...\n","ActiveSupport.on_load :active_record do\n  module ActiveRecord::ConnectionAdapters   \n    class AbstractMysqlAdapter \n      def create_table_with_innodb_row_format(table_name, options = {}) \n        table_options = options.reverse_merge(:options =\u003E 'ENGINE=InnoDB ROW_FORMAT=DYNAMIC')\n\n        create_table_without_innodb_row_format(table_name, table_options) do |td|\n         yield td if block_given? \n        end\n      end\n      alias_method_chain :create_table, :innodb_row_format \n    end\n  end\nend\n","總結-1","附錄unicode-與-utf","附錄：Unicode 與 UTF","utf-8","UTF-8","Information Technology","markdown","garden","md","從 Jekyll 遷移至 WordPress","Crayon Syntax Highlighter","環境部署與架設","wp.php","docker-compose.yml","Tr: 在 Docker Container 裡應該避免的 10 件事","10 things to avoid in docker containers","br","![↩](https:\u002F\u002Fs.w.org\u002Fimages\u002Fcore\u002Femoji\u002F14.0.0\u002Fsvg\u002F21a9.svg)","關於","system","\u002Flegacy-articles\u002F2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup","http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F293\u002F","解決 MySQL 使用 utf8mb4 編碼導致 Rails 資料庫遷移失敗的問題 - 深藏若虛","當 MySQL 使用 utf8mb4 編碼，會導致 Rails 資料庫遷移失敗，並輸出此錯誤訊息的問題：","上面那段訊息的重點在於：","也就說，作為 index 的欄位，他的長度（bytes）已經超過 MySQL 規定的 767 bytes 了，所以被 MySQL 拒絕繼續進行操作。","在一般的情況下，其實 utf8 編碼就已經很夠用了，然而在 MySQL 6.0 前， 使用 utf8 一個字元最多只使用 3-Byte，所以他並不能表達所有 unicode 的字符。若是你的網站會使用的一些罕見字符或是有使用者是用罕見字元當做人名，就可能會不在 utf8 所支援的字符中。所以在 MySQL 5.5 時，新增了 utf8mb4 作為擴充，使最大佔用長度增為 4-byte。","或許你會以為這種情況離生活很遠，但事實上在這個行動裝置隨處可見的情況下，這種情況反而更容易發生。為什麼？因為現在手機、平板等的輸入法，都多會附上表情符號諸如 [😎][😀][😁][😂][😃][😄][😅]","😆","，這 8 個表符都各佔了 4-byte，也就是超過 utf8 的支援。我想讀者應該對這些符號都挺有印象的，所以這種採用 utf8mb4 作為 MySQL 的編碼的需求其實是離我們開發者越來越近。","那是因為 Rails ActiveRecord 的 "," 資料欄位，等同於 MySQL 長度為 255 的 VARCHAR 欄位類型，所以使用 utf8 時，會使用 ","255 * 3 = 765"," (bytes)。","當編碼改成 utf8mb4 後，每個字元固定長度為 4-byte，所以大小就會有 ","255 * 4 = 1020"," (bytes) ，而超過 MySQL 用來當作索引的鍵值長度的最大值。這也就是為什麼在資料庫 Migrate 會報錯的原因所在。","那我們該如何解決這個問題呢？","em","這裡提供的方案僅限於目前網站在開發，並沒有擁有需要保存資料的情況下才能實行","。因為這個方案是透過修改 Rails 在資料表架構上，VARCHAR 類型欄位的預設長度。若是已經有資料的網站，可能會因為修改長度比現存的資料小，導致無法執行。","承襲上章所闡述的問題原因，為了改善這個問題，我們在這裡將 VARCHAR 的長度改成鍵值長度最大值以內。由算式 ","767 \u002F 4 = 191 ... 3"," 可得知，在這個範圍內若以 4-byte 來儲存 1 個字符，我們共可以儲存 191 個字符，最大長度就只會到 764 bytes，符合 MySQL 標準，因而解決這個問題。所以解決方向就如前面所述，要將 Rails 的 VARCHAR 類型欄位的預設長度改成 191 個字符。","這個方法來自於 Github Rails\u002FRails 專案中的 ","Issue #9885"," 中 @nanaya 的留言。","我們在專案目錄下新增 ",".\u002Fconfig\u002Finitializers\u002Fmysqlpls.rb"," 這個檔案，然後將下面的程式碼貼近檔案中儲存，就會將 VARCHAR 類型欄位的預設長度從 255 個字符改成 191 個字符，解決了這個問題。","這個程式碼主要是覆蓋掉原本 Rails 在這部分的設定，也就是說我要針對 ActiveRecord module 下的 ConnectionAdapters module 中的 AbstractMysqlAdapter Class 裡的 NATIVE_DATABASE_TYPES 雜湊常數中的 "," 鍵值所代表的值做重新定義。講得這麼密麻麻，可能有點不懂，我們可以先看看原始針對這部份的定義，如下","這部份就是將 migration 中定義的資料類型轉成 MySQL 的欄位類型，而我們就是將原本 ","string"," 類型定義的長度做了修改並覆蓋。這樣解釋應該好懂很多。想要更深入了解的可以直接看 Rails 關於這部分的","https:\u002F\u002Fgithub.com\u002Frails\u002Frails\u002Fblob\u002Fmaster\u002Factiverecord\u002Flib\u002Factive_record\u002Fconnection_adapters\u002Fabstract_mysql_adapter.rb#L37","原始碼","囉。","本解決方案是直接縮減 Rails 在 ActvieRecord 裡 "," 資料類型中的長度，以符合 MySQL 所支援的大小。","但如前面所述，若是你已經有資料，且你無法確保現有資料中 "," 資料類型的值都在 191 以下的話，就會比較麻煩。可能就要先將結構與資料分別 dump，改完結構後，再將資料中超過長度的值做縮減，最後再重新 import 到資料庫裡。這部分可參考 XDite 關於這部分所書寫的","http:\u002F\u002Fblog.xdite.net\u002Fposts\u002F2013\u002F12\u002F19\u002Fmysql-with-utf8mb4","部落格文章","這個方案我不打算如前一個方案般詳述，主要是因為我沒有實際去實驗，而只是將網路上看到的資料做個整理、筆記而已，實際運作上狀況如何，就不敢保證了，但至少紀錄了一個方向。","在 MySQL 5.5.14 時，新增了一個名為 ","innodb_large_prefix"," 的功能，啟用後可將鍵值長度擴充到 3072 bytes。而這個功能相依於 MySQL 5.5 新增的一個叫做 Barracuda 的 innodb 的檔案格式（File Formate），這個檔案格式除了支援 innodb 原有的資料列格式（Row Formats），還包括了新的資料列格式：COMPRESSED 和 DYNAMIC。","所以要解決這個問題，就是修改 MySQL 的選項，將檔案格式改成 Barracuda，並且啟用 innodb_large_prefix 這個選項去擴充鍵值長度。最後在 Rails 建立表格時，指定使用 DYNAMIC 的資料列格式即可。","在進行本方法前，請先將資料庫備份，或是使用虛擬機器或是容器開一個新的資料庫伺服器作為練習、試驗","在 MySQL 的設定檔 ","my.conf"," 加入下面內容：","在 Rails 部分有兩個選項，擇一即可，見仁見智。有興趣的可以參考在同一篇 Issue 裡，從","https:\u002F\u002Fgithub.com\u002Frails\u002Frails\u002Fissues\u002F9855#issuecomment-57666389","這篇回覆","開始的討論，主要就是 @NaN1488 和 @yyyc514 兩人回覆的部分。","rails-1","Rails (1)","在 migration 中的 ","create_table"," 方法加入 ","option"," 參數：","rails-2","Rails (2)","若是覺得要在每個有建立資料表的 migration 一一加入上述選項的參數太麻煩的話，也可以直接加入一個 MonkeyPatch。這個 patch 會幫你在建立資料表時直接幫你加入該參數。","在專案目錄下新增 ",".\u002Fconfig\u002Finitializers\u002Far_innodb_row_format.rb"," 這個檔案，並貼上程式碼：","與前一方案是透過修改 Rails 對 string 欄位類型的預設長度達到目的，這個方案則是透過升級、修改 MySQL 的設定檔，擴大鍵值長度去修正這個錯誤。","兩個方案方向不一樣，所以也沒有孰優孰劣，就看開發者當前的專案適合哪個方案了。若是沒有資料庫修改權限的，第一個方案我想就是一個挺貼切的做法，也讓專案在部署的難度降低。若是擁有資料庫伺服器管理權限，也可以使用第二個方案，直接一勞永逸囉。","Unicode 是一種文字、符號在電腦科學領域的業界標準，由非營利機構 The Unicode Consortium 負責。在 1991 年 10月發布第一個版本，隔年 6 月發布 1.0.1 擴增了中日韓統一表意文字最初的 20,902 個字，之後陸陸續需編修與擴增。最近的發布是在 2015 年 6 月時的 8.0 版本，總計有 120,737 個字符。","UTF 為 Unicode Transformation Format，中文為 Unicode轉換格式，即為 Unicode 的實作方式。","UTF-8 的全名為 8-bit Unicode Transformation Format，即以 1 個位元組（1-byte = 8-bit）為單位，用 1 到 4 個位元組表示一個字符編碼","http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F293\u002F#fn-293-2","由於 UTF-8 的長度是可變動的，所以 ASCII 可以作為 UTF-8 的一個子集，所以現存的 ASCII 文字不需要轉換。","utf8mb3utf8mb4","utf8mb3、utf8mb4","utf8mb3、utf8mb4 都是 MySQL 所支援的 Unicode 編碼實作，兩者的差別在於 utf8mb3 最大佔用長度為 3-byte，utf8mb4 則為 4-byte。所以其實兩者幾乎是一樣的，但是 utf8mb4 多了對擴充字符的支持，如本篇文章所提到的表情符號。","utf8mb4 是 MySQL 5.5 所新增的，因為原本 MySQL 5.5 的 utf8 只有支持最大佔用長度為 3-byte，所以新增這個實作作為擴充。到了 MySQL 6.0，原本的 utf8 被更名為 utf8mb3，並加入新的 utf8 編碼實作，並預設支最大佔用長度為 4-byte。","http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F293\u002F#fn-293-3","MySQL utf8mb4 breaks ActiveRecord schema setup","https:\u002F\u002Fmathiasbynens.be\u002Fnotes\u002Fmysql-utf8mb4","How to support full Unicode in MySQL databases","https:\u002F\u002Fencoding.spec.whatwg.org\u002F#utf-8","Encoding: Living Standard","http:\u002F\u002Fwww.utf8-chartable.de\u002Funicode-utf8-table.pl?start=128512","UTF-8 encoding table and Unicode characters","https:\u002F\u002Fmothereff.in\u002Fbyte-counter","UTF-8 string length & byte counter","http:\u002F\u002Fblog.kamipo.net\u002Fentry\u002F2012\u002F11\u002F13\u002F102024","MySQL(InnoDB) で “Index column size too large. The maximum column size is 767 bytes.” いわれるときの対策","原來的規範允許長達 6 位元組，但是在 2003 年 11 月 UTF-8 被 RFC 3629 重新規範，只能使用原來 Unicode 定義的區域，即 ","U+0000"," 到 ","U+10FFFF"," 。 ","http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F293\u002F#fnref-293-2","這部分可以參照 ","http:\u002F\u002Fforums.mysql.com\u002Fread.php?3,199803,199803","MySQL 6.0.4 Alpha 的 Release Note","。 ","http:\u002F\u002Fblog.fntsr.tw\u002Farticles\u002F293\u002F#fnref-293-3","MySQL utf8mb4 breaks ActiveRecord schema setup","\u002Flegacy-articles\u002F2016-02-15-from-jekyll-to-wordpress","http:\u002F\u002Flogdown.com\u002F","Logdown","目錄","WordPress 的改變","外掛（Plugin）","Jetpack 由 WordPress.com 團隊開發","UpdraftPlus – Backup\u002FRestore","用 highlight.js 作為 wordpress 程式碼著色的程式","capture_crayons()","if ((CrayonGlobalSettings::val(CrayonSettings::CAPTURE_PRE) || $skip_setting_check) && $in_flag[CrayonSettings::CAPTURE_PRE]) {\n    # 刪除這行\n    $wp_content = preg_replace_callback('#(?\u003C!\\$)\u003C\\s*pre(?=(?:([^\u003E]*)\\bclass\\s*=\\s*([\"\\'])(.*?)\\2([^\u003E]*))?)([^\u003E]*)\u003E(.*?)\u003C\\s*\u002F\\s*pre\\s*\u003E#msi', 'CrayonWP::pre_tag', $wp_content);\n\n    # 以這行取代之\n    $wp_content = preg_replace_callback('#(?\u003C!\\$)\u003C\\s*pre(?=(?:([^\u003E]*)\\bclass\\s*=\\s*([\"\\'])(.*?)\\2([^\u003E]*))?)([^\u003E]*)crayon\u003E(.*?)\u003C\\s*\u002F\\s*pre\\s*\u003E#msi', 'CrayonWP::pre_tag', $wp_content);\n}\n","~~~php"," 轉成 "," ","3","if ((CrayonGlobalSettings::val(CrayonSettings::CAPTURE_PRE) || $skip_setting_check) && $in_flag[CrayonSettings::CAPTURE_PRE]) {\n    # 加入這行，要放在這個判斷式裡的首行\n    $wp_content = preg_replace_callback('#(?\u003C!\\$)\u003C\\s*pre\\s*\u003E\\s*\u003Ccode\u003E(.*?)\u003C\u002Fcode\u003E\\s*\u003C\\s*\u002F\\s*pre\\s*\u003E#msi', 'CrayonWP::pre_code_tag', $wp_content);\n\n    # 這是我們在上面加入，不過本次修改不相依上面的修改，不一定改過這行。\n    $wp_content = preg_replace_callback('#(?\u003C!\\$)\u003C\\s*pre(?=(?:([^\u003E]*)\\bclass\\s*=\\s*([\"\\'])(.*?)\\2([^\u003E]*))?)([^\u003E]*)crayon\u003E(.*?)\u003C\\s*\u002F\\s*pre\\s*\u003E#msi', 'CrayonWP::pre_tag', $wp_content);\n}\n","class CrayonWP {\n    ....\n\n    # 加入此方法去轉換格式\n    public static function pre_code_tag($matches) {\n        $lang = $matches[1];\n        $content = $matches[2];\n\n        # 這邊要注意如果你沒有套用上面 `\u003Cpre crayon\u003E` 的修改，要將 ` crayon` 刪除\n        $result = \"\u003Cpre class=\\\"lang:{$lang}\\\" crayon\u003E{$content}\u003C\u002Fpre\u003E\";\n        return $result;\n    }\n\n    ...\n}\n","wordpress:\n  image: wordpress:4.7.1-php7.1-apache\n  restart: always\n  environment:\n    WORDPRESS_DB_PASSWORD: YOUR_PASSWORD\n  links:\n    - db:mysql\n  ports:\n    - 8080:80\n  volumes:\n    - .\u002Fwp-content:\u002Fvar\u002Fwww\u002Fhtml\u002Fwp-content\n\ndb:\n  image: mariadb\n  restart: always\n  environment:\n    MYSQL_ROOT_PASSWORD: YOUR_PASSWORD\n  volumes:\n    - .\u002Fdatabase:\u002Fvar\u002Flib\u002Fmysql\n"," 或 ","From Jekyll to Wordpress","docker","\u002Flegacy-articles\u002F2016-03-06-10-things-to-avoid-in-docker-containers","來源","譯文","https:\u002F\u002Fi0.wp.com\u002Fblog.fntsr.tw\u002Fwp-content\u002Fuploads\u002F2016\u002F03\u002Fcontainers_are_-ephemeral.png?ssl=1","http:\u002F\u002Fdevelopers.redhat.com\u002Fcontainers\u002F","譯註","del","\u002Fabout","如何敘述異常回報","\u002F")))}</script><script type="module" src="/_nuxt/entry.ef07ec96.js" crossorigin></script><script type="module" src="/_nuxt/default.b6929f5c.js" crossorigin></script><script type="module" src="/_nuxt/_...slug_.8ae6e501.js" crossorigin></script><script type="module" src="/_nuxt/ContentDoc.7177145d.js" crossorigin></script><script type="module" src="/_nuxt/ContentQuery.9abfbc96.js" crossorigin></script><script type="module" src="/_nuxt/PostHeader.7970c087.js" crossorigin></script><script type="module" src="/_nuxt/PageTitle.60b3d867.js" crossorigin></script><script type="module" src="/_nuxt/PageSubtitle.678c226e.js" crossorigin></script><script type="module" src="/_nuxt/PageDate.765473d4.js" crossorigin></script></body>
</html>