[{"_path":"/legacy-articles/2014-10-31-use-docker-data-volume-on-os-x","_dir":"legacy-articles","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"在 OS X 上，透過 boot2docker 使用 docker 的 data volume","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/175/","rel":["nofollow"]},"children":[{"type":"text","value":"Site is undergoing maintenance"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Docker 1.3 在 2014-10-16 釋出。其中，在方便性上最讓人注目的更新，除了 exec 指令以外，就是 boot2docker 在 Mac OS X 資料夾分享功能的改進，本文主要是針對後者去做講述。"}]},{"type":"element","tag":"h6","props":{"id":"2017-01-16-補充"},"children":[{"type":"text","value":"2017-01-16 補充"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"有別於以往，現在 Docker 已經到了 1.12.6，在 Mac OS X 上的安裝方式也不再是 boot2docker，而是另外有安裝程式去做最佳化，包括 data volume 的使用也更加方便了，所以關於 boot2docker 的操作已經不適用了。不過現在的掛載原理其實是大同小異的，本篇提到在 Mac OS X 是如何建立 Volume 功能的概念還是可以去了解的。"}]},{"type":"element","tag":"h2","props":{"id":"前言"},"children":[{"type":"text","value":"前言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由於 Docker 只支持 Linux 作業系統，倘若要於 OS X 使用 Docker ，會使用 boot2docker 這個工具，在 VirtualBox 上建立一個 boot2docker-vm 的映像檔。然後，透過這個 Linux VM 去操作 Docker。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但是，在 Docker 1.3 之前，因為 boot2docker 的映像檔沒有支援 VirtualBox Guest Additions ，所以無法使用 Virtualbox 分享資料夾的功能，將 OS X 的資料夾掛載到虛擬機器裡。因此必須另外自行製作有支援該 VirtualBox Guest Additions 的映像檔（或是下載別人做好的），然後設定 Virtual Box ，把 OS X 的資料夾自動掛載到虛擬機器裡。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不過，隨著 Docker 1.3 釋出，boot2docker 也一併將這個功能引入。使用者可以直接透過 boot2docker 的映像檔使用這功能，而且它會自動把 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/Users"}]},{"type":"text","value":" 資料夾掛載到虛擬機器裡，不需要另外設定！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下圖是在 OS X 上，使用 boot2docker 建立 data volume 的示意圖，希望能幫助各位了解運作原理。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"2014-10-31-use-docker-data-volume-on-os-x-001-300x225.png","src":"2014-10-31-use-docker-data-volume-on-os-x-001-300x225.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"前置作業"},"children":[{"type":"text","value":"前置作業"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在開始前，必須先安裝或更新 docker 和 boot2docker 到 1.3.0 以上的版本，更新的方法在我前一篇文章 "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/2014/10/31/upgrade-docker-and-boot2docker-on-os-x/","rel":["nofollow"]},"children":[{"type":"text","value":"Upgrade Docker and Boot2docker on OS X"}]},{"type":"text","value":" 已經說明了，可以參考看看，這邊就不多贅述。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接著在 Terminal 下 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$ boot2docker ssh 'ls -al /Users'"}]},{"type":"text","value":" 的指令，確認是否已經成功掛載。如果成功，應該會出現 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/Users"}]},{"type":"text","value":" 的目錄。"}]},{"type":"element","tag":"code","props":{"code":"$ boot2docker ssh 'ls -al /Users'\n# drwxr-xr-x    1 docker   staff          204 Mar 29  2014 .\n# drwxr-xr-x   17 root     root           400 Oct 31 10:29 ..\n# -rw-r--r--    1 docker   staff            0 Aug 25  2013 .localized\n# drwxrwxrwx    1 docker   staff          306 Oct 18 04:08 Shared\n# drwxr-xr-x    1 docker   staff         3774 Oct 31 17:52 user5566\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ boot2docker ssh 'ls -al /Users'\n# drwxr-xr-x    1 docker   staff          204 Mar 29  2014 .\n# drwxr-xr-x   17 root     root           400 Oct 31 10:29 ..\n# -rw-r--r--    1 docker   staff            0 Aug 25  2013 .localized\n# drwxrwxrwx    1 docker   staff          306 Oct 18 04:08 Shared\n# drwxr-xr-x    1 docker   staff         3774 Oct 31 17:52 user5566\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"data-volume"},"children":[{"type":"text","value":"Data Volume"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本文利用 ubuntu 的 images 去做建立 data volume 的示範。開始前，再次強調，因為 boot2docker 只有把 OS X 的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/Users"}]},{"type":"text","value":" 資料夾掛載到虛擬機上，所以 data volume 的 host 資料夾必須在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/Users"}]},{"type":"text","value":" 底下。"}]},{"type":"element","tag":"h3","props":{"id":"首先"},"children":[{"type":"text","value":"首先"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"把想建立 data volume 的資料夾與檔案準備好。"}]},{"type":"element","tag":"code","props":{"code":"$ mkdir ~/docker-volume/test\n$ touch ~/docker-volume/test/volume-test.md\n$ ls -al ~/docker-volume/test\n# total 0\n# drwxr-xr-x  3 user5566  staff  102 11  1 02:01 .\n# drwxr-xr-x  3 user5566  staff  102 11  1 02:01 ..\n# -rw-r--r--  1 user5566  staff    0 11  1 02:01 volume-test.md\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ mkdir ~/docker-volume/test\n$ touch ~/docker-volume/test/volume-test.md\n$ ls -al ~/docker-volume/test\n# total 0\n# drwxr-xr-x  3 user5566  staff  102 11  1 02:01 .\n# drwxr-xr-x  3 user5566  staff  102 11  1 02:01 ..\n# -rw-r--r--  1 user5566  staff    0 11  1 02:01 volume-test.md\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"接著"},"children":[{"type":"text","value":"接著"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"建立一個 Container 。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"並且，將剛才建立的資料夾，透過 data volume 掛載到 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/volume_test"}]},{"type":"text","value":" 的位置。並且確認是否成功。"}]},{"type":"element","tag":"code","props":{"code":"# 建立 Container\n$ docker run -it -v ~/docker-volume/test:/volume_test ubuntu:latest /bin/bash\nroot@d0d097097657:\n\n# 測試 data volume 是否成功\nroot@d0d097097657: ls -al /volume_test/\n# total 4\n# drwxr-xr-x  1 1000 staff  102 Oct 31  2014 ./\n# drwxr-xr-x 50 root root  4096 Oct 31 17:51 ../\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 volume-test.md\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# 建立 Container\n$ docker run -it -v ~/docker-volume/test:/volume_test ubuntu:latest /bin/bash\nroot@d0d097097657:\n\n# 測試 data volume 是否成功\nroot@d0d097097657: ls -al /volume_test/\n# total 4\n# drwxr-xr-x  1 1000 staff  102 Oct 31  2014 ./\n# drwxr-xr-x 50 root root  4096 Oct 31 17:51 ../\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 volume-test.md\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"最後"},"children":[{"type":"text","value":"最後"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 OS X 和 Container 中，都建立一個檔案，以測試同步與否。"}]},{"type":"element","tag":"code","props":{"code":"# OS X\n$ touch ~/docker-volume/test/file-from-osx.md\n\n# Container\nroot@d0d097097657: touch /volume_test/file-from-container.md\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# OS X\n$ touch ~/docker-volume/test/file-from-osx.md\n\n# Container\nroot@d0d097097657: touch /volume_test/file-from-container.md\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看起來是成功了，歡呼囉！"}]},{"type":"element","tag":"code","props":{"code":"# OS X 確認\n$ ls -al ~/docker-volume/test\n# total 0\n# drwxr-xr-x  5 user5566  staff   170B 11  1 02:12 .\n# drwxr-xr-x  3 user5566  staff   102B 11  1 02:01 ..\n# -rw-r--r--  1 user5566  staff     0B 11  1 01:58 file-from-container.md\n# -rw-r--r--  1 user5566  staff     0B 11  1 02:12 file-from-osx.md\n# -rw-r--r--  1 user5566  staff     0B 11  1 02:01 volume-test.md\n\n# Container 確認\nroot@d0d097097657: ls -al /volume_test/\n# total 4\n# drwxr-xr-x  1 1000 staff  170 Oct 31  2014 .\n# drwxr-xr-x 50 root root  4096 Oct 31 17:51 ..\n# -rw-r--r--  1 1000 staff    0 Oct 31 17:58 file-from-container.md\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 file-from-osx.md\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 volume-test.md\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# OS X 確認\n$ ls -al ~/docker-volume/test\n# total 0\n# drwxr-xr-x  5 user5566  staff   170B 11  1 02:12 .\n# drwxr-xr-x  3 user5566  staff   102B 11  1 02:01 ..\n# -rw-r--r--  1 user5566  staff     0B 11  1 01:58 file-from-container.md\n# -rw-r--r--  1 user5566  staff     0B 11  1 02:12 file-from-osx.md\n# -rw-r--r--  1 user5566  staff     0B 11  1 02:01 volume-test.md\n\n# Container 確認\nroot@d0d097097657: ls -al /volume_test/\n# total 4\n# drwxr-xr-x  1 1000 staff  170 Oct 31  2014 .\n# drwxr-xr-x 50 root root  4096 Oct 31 17:51 ..\n# -rw-r--r--  1 1000 staff    0 Oct 31 17:58 file-from-container.md\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 file-from-osx.md\n# -rw-r--r--  1 1000 staff    0 Oct 31  2014 volume-test.md\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"後記"},"children":[{"type":"text","value":"後記"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Data Volume 是 docker 在應用 LXC 時，一個非常重要的功能。在初學 Docker 前，因為不懂 boot2docker 的運作原理，在這功能鬼打牆好多次，都無法成功。後來知道原理後，卻覺得在 OS X 實作這功能太麻煩了，改用 VPS 直接用 Linux 去玩 Docker 。還好，現在 boot2docker 已經做好這件事了，讓我們可以更快樂的在 OS X 上面玩 Docker ，尤其是進行開發啦！(rock)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"剛好，這塊是我在 "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/2014/10/18/how-to-deploy-php-projects-with-docker/","rel":["nofollow"]},"children":[{"type":"text","value":"PHPConf 演講"}]},{"type":"text","value":" 裡，只有稍微帶過的部分，希望這篇文章能補足當時因為時間關係，而沒講明的部分。在之後，我也會把握空閒時間，多寫幾篇有關 Docker 的文章，補足演講的缺口，希望大家會喜歡。 =D"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後，祝各位在 OS X 上，愜意地 Docker 囉！"}]},{"type":"element","tag":"h2","props":{"id":"reference"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://medium.com/boot2docker-lightweight-linux-for-docker/boot2docker-together-with-virtualbox-guest-additions-da1e3ab2465c","rel":["nofollow"]},"children":[{"type":"text","value":"boot2docker together with VirtualBox Guest Additions: How to mount /Users into boot2docker"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://docs.docker.com/userguide/dockervolumes/","rel":["nofollow"]},"children":[{"type":"text","value":"Managing Data in Containers"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://blog.docker.com/2014/10/docker-1-3-signed-images-process-injection-security-options-mac-shared-directories/","rel":["nofollow"]},"children":[{"type":"text","value":"DOCKER 1.3: SIGNED IMAGES, PROCESS INJECTION, SECURITY OPTIONS, MAC SHARED DIRECTORIES"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/boot2docker/boot2docker","rel":["nofollow"]},"children":[{"type":"text","value":"boot2docker/boot2docker"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/boot2docker/boot2docker/issues/282#issuecomment-44601104","rel":["nofollow"]},"children":[{"type":"text","value":"Volumes: vboxguest + vboxsf modules #282"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.facebook.com/groups/docker.taipei/permalink/1522080854693939/","rel":["nofollow"]},"children":[{"type":"text","value":"Post of Docker.Taipei"}]}]}]}]},"title_en":"Use docker data volume on OS X","slug":"use-docker-data-volume-on-os-x","aliases":["在 OS X 上，透過 boot2docker 使用 docker 的 data volume","Use docker data volume on OS X"],"created_at":"2014-10-31T22:05:04.000Z","published_at":null,"updated_at":null,"tags":["docker"],"moc":["Information Technology"],"_type":"markdown","_id":"garden:legacy-articles:2014-10-31-use-docker-data-volume-on-os-x.md","_source":"garden","_file":"legacy-articles/2014-10-31-use-docker-data-volume-on-os-x.md","_extension":"md"},{"_path":"/legacy-articles/2014-11-08-docker-cant-resolve-github-com","_dir":"legacy-articles","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Docker 無法解析 github.com","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/183/","rel":["nofollow"]},"children":[{"type":"text","value":"Site is undergoing maintenance"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Ubuntu 環境下，使用 Docker 架設 Discourse 時遇到了問題，錯誤訊息如下："}]},{"type":"element","tag":"code","props":{"code":"fatal: unable to access 'https://github.com/SamSaffron/pups.git/': Could not resolve host: github.com\nfb4e120a8b107f0ec1e07b3e21a3a1f31e3a5879d30da65242e0333b30533efa\nFAILED TO BOOTSTRAP\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"fatal: unable to access 'https://github.com/SamSaffron/pups.git/': Could not resolve host: github.com\nfb4e120a8b107f0ec1e07b3e21a3a1f31e3a5879d30da65242e0333b30533efa\nFAILED TO BOOTSTRAP\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個問題的是 DNS 相關的錯誤，我們只要幫 Docker 指定 DNS Server 即可。解決辦法依照你安裝 Docker 的方式而異。"}]},{"type":"element","tag":"h2","props":{"id":"via-ubuntu-package"},"children":[{"type":"text","value":"via Ubuntu Package"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先，打開 docker 的設定檔。"}]},{"type":"element","tag":"code","props":{"code":"$ vim /etc/default/docker\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ vim /etc/default/docker\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然後，將下面這行取消註解。"}]},{"type":"element","tag":"code","props":{"code":"DOCKER_OPTS=\"--dns 8.8.8.8 --dns 8.8.4.4\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"DOCKER_OPTS=\"--dns 8.8.8.8 --dns 8.8.4.4\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後，重啟 Docker Server"}]},{"type":"element","tag":"code","props":{"code":"$ sudo service docker restart\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ sudo service docker restart\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"via-binary"},"children":[{"type":"text","value":"via Binary"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你是透過二進位檔案執行 Docker server，你只需在啟動 Docker daemon 時，加上 DNS 參數即可。如下："}]},{"type":"element","tag":"code","props":{"code":"$ sudo docker -d -D --dns 8.8.8.8 --dns 8.8.4.4 &\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ sudo docker -d -D --dns 8.8.8.8 --dns 8.8.4.4 &\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"8.8.8.8"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"8.8.4.4"}]},{"type":"text","value":"都是 Google 的 DNS，你也可以增修你喜歡的 DNS Server。"}]},{"type":"element","tag":"h2","props":{"id":"reference"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-discourse-on-ubuntu-14-04","rel":["nofollow"]},"children":[{"type":"text","value":"How To Install Discourse on Ubuntu 14.04"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://meta.discourse.org/t/afatal-unable-to-access-https-github-com-samsaffron-pups-git-could-not-resolve-host-github-com/18611","rel":["nofollow"]},"children":[{"type":"text","value":"A fatal: unable to access ‘….’: Could not resolve host: github.com"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://stackoverflow.com/questions/24151129/docker-network-calls-fail-during-image-build-on-corporate-network","rel":["nofollow"]},"children":[{"type":"text","value":"Docker – Network calls fail during image build on corporate network"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://linux.vbird.org/linux_server/0350dns.php#DNS_resolver_file","rel":["nofollow"]},"children":[{"type":"text","value":"鳥哥的 Linux 私房菜 – 第十九章、主機名稱控制者： DNS 伺服器"}]}]}]}]},"title_en":"Docker can't resolve github.com","slug":"docker-cant-resolve-github-com","aliases":["Docker 無法解析 github.com","Docker can't resolve github.com"],"created_at":"2014-11-08T02:30:19.000Z","published_at":null,"updated_at":null,"tags":["docker"],"moc":["Information Technology"],"_type":"markdown","_id":"garden:legacy-articles:2014-11-08-docker-cant-resolve-github-com.md","_source":"garden","_file":"legacy-articles/2014-11-08-docker-cant-resolve-github-com.md","_extension":"md"}]