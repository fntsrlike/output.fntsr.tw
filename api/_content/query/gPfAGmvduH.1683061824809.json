[{"_path":"/legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup","_dir":"legacy-articles","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"è§£æ±º MySQL ä½¿ç”¨ utf8mb4 ç·¨ç¢¼å°è‡´ Rails è³‡æ–™åº«é·ç§»å¤±æ•—çš„å•é¡Œ","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/293/","rel":["nofollow"]},"children":[{"type":"text","value":"è§£æ±º MySQL ä½¿ç”¨ utf8mb4 ç·¨ç¢¼å°è‡´ Rails è³‡æ–™åº«é·ç§»å¤±æ•—çš„å•é¡Œ - æ·±è—è‹¥è™›"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç•¶ MySQL ä½¿ç”¨Â utf8mb4Â ç·¨ç¢¼ï¼Œæœƒå°è‡´ Rails è³‡æ–™åº«é·ç§»å¤±æ•—ï¼Œä¸¦è¼¸å‡ºæ­¤éŒ¯èª¤è¨Šæ¯çš„å•é¡Œï¼š"}]},{"type":"element","tag":"code","props":{"code":"~/app $ RAILS_ENV=production rake db:migrate\n\n== 20150226092347 DeviseCreateUsers: migrating================================\n-- create_table(:users)\n   -> 0.0070s\n-- add_index(:users, :email, {:unique=>true})\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\nMysql2::Error: Specified key was too long; max key length is 767 bytes: CREATE UNIQUE INDEX `index_users_on_email`  ON `users` (`email`) ~/.rvm/gems/ruby-2.2.2/gems/mysql2-0.4.2/lib/mysql2/client.rb:107:in `_query'\n......\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"~/app $ RAILS_ENV=production rake db:migrate\n\n== 20150226092347 DeviseCreateUsers: migrating================================\n-- create_table(:users)\n   -> 0.0070s\n-- add_index(:users, :email, {:unique=>true})\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\nMysql2::Error: Specified key was too long; max key length is 767 bytes: CREATE UNIQUE INDEX `index_users_on_email`  ON `users` (`email`) ~/.rvm/gems/ruby-2.2.2/gems/mysql2-0.4.2/lib/mysql2/client.rb:107:in `_query'\n......\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸Šé¢é‚£æ®µè¨Šæ¯çš„é‡é»åœ¨æ–¼ï¼š"}]},{"type":"element","tag":"code","props":{"code":"Mysql2::Error: Specified key was too long; max key length is 767 bytes\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Mysql2::Error: Specified key was too long; max key length is 767 bytes\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¹Ÿå°±èªªï¼Œä½œç‚º index çš„æ¬„ä½ï¼Œä»–çš„é•·åº¦ï¼ˆbytesï¼‰å·²ç¶“è¶…é MySQL è¦å®šçš„ 767 bytes äº†ï¼Œæ‰€ä»¥è¢« MySQL æ‹’çµ•ç¹¼çºŒé€²è¡Œæ“ä½œã€‚"}]},{"type":"element","tag":"h2","props":{"id":"ä»€éº¼æ™‚å€™æœƒæ¡ç”¨utf8mb4ä½œç‚º-mysql-çš„ç·¨ç¢¼"},"children":[{"type":"text","value":"ä»€éº¼æ™‚å€™æœƒæ¡ç”¨Â utf8mb4Â ä½œç‚º MySQL çš„ç·¨ç¢¼ï¼Ÿ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ä¸€èˆ¬çš„æƒ…æ³ä¸‹ï¼Œå…¶å¯¦Â utf8Â ç·¨ç¢¼å°±å·²ç¶“å¾ˆå¤ ç”¨äº†ï¼Œç„¶è€Œåœ¨ MySQL 6.0 å‰ï¼ŒÂ ä½¿ç”¨Â utf8Â ä¸€å€‹å­—å…ƒæœ€å¤šåªä½¿ç”¨ 3-Byteï¼Œæ‰€ä»¥ä»–ä¸¦ä¸èƒ½è¡¨é”æ‰€æœ‰ unicode çš„å­—ç¬¦ã€‚è‹¥æ˜¯ä½ çš„ç¶²ç«™æœƒä½¿ç”¨çš„ä¸€äº›ç½•è¦‹å­—ç¬¦æˆ–æ˜¯æœ‰ä½¿ç”¨è€…æ˜¯ç”¨ç½•è¦‹å­—å…ƒç•¶åšäººåï¼Œå°±å¯èƒ½æœƒä¸åœ¨Â utf8Â æ‰€æ”¯æ´çš„å­—ç¬¦ä¸­ã€‚æ‰€ä»¥åœ¨ MySQL 5.5 æ™‚ï¼Œæ–°å¢äº†Â utf8mb4Â ä½œç‚ºæ“´å……ï¼Œä½¿æœ€å¤§ä½”ç”¨é•·åº¦å¢ç‚º 4-byteã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æˆ–è¨±ä½ æœƒä»¥ç‚ºé€™ç¨®æƒ…æ³é›¢ç”Ÿæ´»å¾ˆé ï¼Œä½†äº‹å¯¦ä¸Šåœ¨é€™å€‹è¡Œå‹•è£ç½®éš¨è™•å¯è¦‹çš„æƒ…æ³ä¸‹ï¼Œé€™ç¨®æƒ…æ³åè€Œæ›´å®¹æ˜“ç™¼ç”Ÿã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºç¾åœ¨æ‰‹æ©Ÿã€å¹³æ¿ç­‰çš„è¼¸å…¥æ³•ï¼Œéƒ½å¤šæœƒé™„ä¸Šè¡¨æƒ…ç¬¦è™Ÿè«¸å¦‚Â [ğŸ˜][ğŸ˜€][ğŸ˜][ğŸ˜‚][ğŸ˜ƒ][ğŸ˜„][ğŸ˜…]"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ğŸ˜†"}]},{"type":"text","value":"ï¼Œé€™ 8 å€‹è¡¨ç¬¦éƒ½å„ä½”äº† 4-byteï¼Œä¹Ÿå°±æ˜¯è¶…éÂ utf8Â çš„æ”¯æ´ã€‚æˆ‘æƒ³è®€è€…æ‡‰è©²å°é€™äº›ç¬¦è™Ÿéƒ½æŒºæœ‰å°è±¡çš„ï¼Œæ‰€ä»¥é€™ç¨®æ¡ç”¨Â utf8mb4Â ä½œç‚º MySQL çš„ç·¨ç¢¼çš„éœ€æ±‚å…¶å¯¦æ˜¯é›¢æˆ‘å€‘é–‹ç™¼è€…è¶Šä¾†è¶Šè¿‘ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://i0.wp.com/blog.fntsr.tw/wp-content/uploads/2016/02/%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7-2016-02-20-%E4%B8%8A%E5%8D%883.12.53.png?ssl=1","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"https://i0.wp.com/blog.fntsr.tw/wp-content/uploads/2016/02/%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7-2016-02-20-%E4%B8%8A%E5%8D%883.12.53.png?ssl=1"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"ç‚ºä»€éº¼-rails-æ”¹ç”¨utf8mb4ç·¨ç¢¼å°±æœƒè¶…éé•·åº¦å‘¢"},"children":[{"type":"text","value":"ç‚ºä»€éº¼ Rails æ”¹ç”¨Â utf8mb4Â ç·¨ç¢¼å°±æœƒè¶…éé•·åº¦å‘¢ï¼Ÿ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é‚£æ˜¯å› ç‚º Rails ActiveRecord çš„Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":":string"}]},{"type":"text","value":"Â è³‡æ–™æ¬„ä½ï¼Œç­‰åŒæ–¼ MySQL é•·åº¦ç‚º 255 çš„Â VARCHARÂ æ¬„ä½é¡å‹ï¼Œæ‰€ä»¥ä½¿ç”¨Â utf8Â æ™‚ï¼Œæœƒä½¿ç”¨Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"255 * 3 = 765"}]},{"type":"text","value":"Â (bytes)ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç•¶ç·¨ç¢¼æ”¹æˆÂ utf8mb4Â å¾Œï¼Œæ¯å€‹å­—å…ƒå›ºå®šé•·åº¦ç‚º 4-byteï¼Œæ‰€ä»¥å¤§å°å°±æœƒæœ‰Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"255 * 4 = 1020"}]},{"type":"text","value":"Â (bytes)Â ï¼Œè€Œè¶…é MySQL ç”¨ä¾†ç•¶ä½œç´¢å¼•çš„éµå€¼é•·åº¦çš„æœ€å¤§å€¼ã€‚é€™ä¹Ÿå°±æ˜¯ç‚ºä»€éº¼åœ¨è³‡æ–™åº« Migrate æœƒå ±éŒ¯çš„åŸå› æ‰€åœ¨ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"è§£æ±ºæ–¹æ¡ˆ-1"},"children":[{"type":"text","value":"è§£æ±ºæ–¹æ¡ˆ (1)"}]},{"type":"element","tag":"h3","props":{"id":"æ–¹å‘"},"children":[{"type":"text","value":"æ–¹å‘"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é‚£æˆ‘å€‘è©²å¦‚ä½•è§£æ±ºé€™å€‹å•é¡Œå‘¢ï¼Ÿ"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"é€™è£¡æä¾›çš„æ–¹æ¡ˆåƒ…é™æ–¼ç›®å‰ç¶²ç«™åœ¨é–‹ç™¼ï¼Œä¸¦æ²’æœ‰æ“æœ‰éœ€è¦ä¿å­˜è³‡æ–™çš„æƒ…æ³ä¸‹æ‰èƒ½å¯¦è¡Œ"}]},{"type":"text","value":"ã€‚å› ç‚ºé€™å€‹æ–¹æ¡ˆæ˜¯é€éä¿®æ”¹ Rails åœ¨è³‡æ–™è¡¨æ¶æ§‹ä¸Šï¼ŒVARCHAR é¡å‹æ¬„ä½çš„é è¨­é•·åº¦ã€‚è‹¥æ˜¯å·²ç¶“æœ‰è³‡æ–™çš„ç¶²ç«™ï¼Œå¯èƒ½æœƒå› ç‚ºä¿®æ”¹é•·åº¦æ¯”ç¾å­˜çš„è³‡æ–™å°ï¼Œå°è‡´ç„¡æ³•åŸ·è¡Œã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰¿è¥²ä¸Šç« æ‰€é—¡è¿°çš„å•é¡ŒåŸå› ï¼Œç‚ºäº†æ”¹å–„é€™å€‹å•é¡Œï¼Œæˆ‘å€‘åœ¨é€™è£¡å°‡Â VARCHARÂ çš„é•·åº¦æ”¹æˆéµå€¼é•·åº¦æœ€å¤§å€¼ä»¥å…§ã€‚ç”±ç®—å¼Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"767 / 4 = 191 ... 3"}]},{"type":"text","value":"Â å¯å¾—çŸ¥ï¼Œåœ¨é€™å€‹ç¯„åœå…§è‹¥ä»¥ 4-byte ä¾†å„²å­˜ 1 å€‹å­—ç¬¦ï¼Œæˆ‘å€‘å…±å¯ä»¥å„²å­˜ 191 å€‹å­—ç¬¦ï¼Œæœ€å¤§é•·åº¦å°±åªæœƒåˆ° 764 bytesï¼Œç¬¦åˆ MySQL æ¨™æº–ï¼Œå› è€Œè§£æ±ºé€™å€‹å•é¡Œã€‚æ‰€ä»¥è§£æ±ºæ–¹å‘å°±å¦‚å‰é¢æ‰€è¿°ï¼Œè¦å°‡ Rails çš„Â VARCHARÂ é¡å‹æ¬„ä½çš„é è¨­é•·åº¦æ”¹æˆ 191 å€‹å­—ç¬¦ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"æ–¹æ³•"},"children":[{"type":"text","value":"æ–¹æ³•"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™å€‹æ–¹æ³•ä¾†è‡ªæ–¼ Github Rails/Rails å°ˆæ¡ˆä¸­çš„Â "},{"type":"element","tag":"a","props":{"href":"https://github.com/rails/rails/issues/9855","rel":["nofollow"]},"children":[{"type":"text","value":"Issue #9885"}]},{"type":"text","value":"Â ä¸­ @nanaya çš„ç•™è¨€ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æˆ‘å€‘åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ–°å¢Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./config/initializers/mysqlpls.rb"}]},{"type":"text","value":"Â é€™å€‹æª”æ¡ˆï¼Œç„¶å¾Œå°‡ä¸‹é¢çš„ç¨‹å¼ç¢¼è²¼è¿‘æª”æ¡ˆä¸­å„²å­˜ï¼Œå°±æœƒå°‡Â VARCHARÂ é¡å‹æ¬„ä½çš„é è¨­é•·åº¦å¾ 255 å€‹å­—ç¬¦æ”¹æˆ 191 å€‹å­—ç¬¦ï¼Œè§£æ±ºäº†é€™å€‹å•é¡Œã€‚"}]},{"type":"element","tag":"code","props":{"code":"# config/initializers/mysqlpls.rb\nrequire 'active_record/connection_adapters/abstract_mysql_adapter'\n\nmodule ActiveRecord\n  module ConnectionAdapters\n    class AbstractMysqlAdapter\n      NATIVE_DATABASE_TYPES[:string] = { :name => \"varchar\", :limit => 191 }\n    end\n  end\nend\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# config/initializers/mysqlpls.rb\nrequire 'active_record/connection_adapters/abstract_mysql_adapter'\n\nmodule ActiveRecord\n  module ConnectionAdapters\n    class AbstractMysqlAdapter\n      NATIVE_DATABASE_TYPES[:string] = { :name => \"varchar\", :limit => 191 }\n    end\n  end\nend\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™å€‹ç¨‹å¼ç¢¼ä¸»è¦æ˜¯è¦†è“‹æ‰åŸæœ¬ Rails åœ¨é€™éƒ¨åˆ†çš„è¨­å®šï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘è¦é‡å° ActiveRecord module ä¸‹çš„ ConnectionAdapters module ä¸­çš„ AbstractMysqlAdapter Class è£¡çš„ NATIVE_DATABASE_TYPES é›œæ¹Šå¸¸æ•¸ä¸­çš„Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":":string"}]},{"type":"text","value":"Â éµå€¼æ‰€ä»£è¡¨çš„å€¼åšé‡æ–°å®šç¾©ã€‚è¬›å¾—é€™éº¼å¯†éº»éº»ï¼Œå¯èƒ½æœ‰é»ä¸æ‡‚ï¼Œæˆ‘å€‘å¯ä»¥å…ˆçœ‹çœ‹åŸå§‹é‡å°é€™éƒ¨ä»½çš„å®šç¾©ï¼Œå¦‚ä¸‹"}]},{"type":"element","tag":"code","props":{"code":"NATIVE_DATABASE_TYPES = {\n  primary_key: \"int auto_increment PRIMARY KEY\",\n  string:      { name: \"varchar\", limit: 255 },\n  text:        { name: \"text\" },\n  integer:     { name: \"int\", limit: 4 },\n  float:       { name: \"float\" },\n  decimal:     { name: \"decimal\" },\n  datetime:    { name: \"datetime\" },\n  time:        { name: \"time\" },\n  date:        { name: \"date\" },\n  binary:      { name: \"blob\" },\n  boolean:     { name: \"tinyint\", limit: 1 },\n  json:        { name: \"json\" },\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"NATIVE_DATABASE_TYPES = {\n  primary_key: \"int auto_increment PRIMARY KEY\",\n  string:      { name: \"varchar\", limit: 255 },\n  text:        { name: \"text\" },\n  integer:     { name: \"int\", limit: 4 },\n  float:       { name: \"float\" },\n  decimal:     { name: \"decimal\" },\n  datetime:    { name: \"datetime\" },\n  time:        { name: \"time\" },\n  date:        { name: \"date\" },\n  binary:      { name: \"blob\" },\n  boolean:     { name: \"tinyint\", limit: 1 },\n  json:        { name: \"json\" },\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™éƒ¨ä»½å°±æ˜¯å°‡ migration ä¸­å®šç¾©çš„è³‡æ–™é¡å‹è½‰æˆ MySQL çš„æ¬„ä½é¡å‹ï¼Œè€Œæˆ‘å€‘å°±æ˜¯å°‡åŸæœ¬ "},{"type":"element","tag":"string","props":{},"children":[]},{"type":"text","value":" é¡å‹å®šç¾©çš„é•·åº¦åšäº†ä¿®æ”¹ä¸¦è¦†è“‹ã€‚é€™æ¨£è§£é‡‹æ‡‰è©²å¥½æ‡‚å¾ˆå¤šã€‚æƒ³è¦æ›´æ·±å…¥äº†è§£çš„å¯ä»¥ç›´æ¥çœ‹ Rails é—œæ–¼é€™éƒ¨åˆ†çš„"},{"type":"element","tag":"a","props":{"href":"https://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L37","rel":["nofollow"]},"children":[{"type":"text","value":"åŸå§‹ç¢¼"}]},{"type":"text","value":"å›‰ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"ç¸½çµ"},"children":[{"type":"text","value":"ç¸½çµ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æœ¬è§£æ±ºæ–¹æ¡ˆæ˜¯ç›´æ¥ç¸®æ¸› Rails åœ¨ ActvieRecord è£¡Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":":string"}]},{"type":"text","value":"Â è³‡æ–™é¡å‹ä¸­çš„é•·åº¦ï¼Œä»¥ç¬¦åˆ MySQL æ‰€æ”¯æ´çš„å¤§å°ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä½†å¦‚å‰é¢æ‰€è¿°ï¼Œè‹¥æ˜¯ä½ å·²ç¶“æœ‰è³‡æ–™ï¼Œä¸”ä½ ç„¡æ³•ç¢ºä¿ç¾æœ‰è³‡æ–™ä¸­Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":":string"}]},{"type":"text","value":"Â è³‡æ–™é¡å‹çš„å€¼éƒ½åœ¨ 191 ä»¥ä¸‹çš„è©±ï¼Œå°±æœƒæ¯”è¼ƒéº»ç…©ã€‚å¯èƒ½å°±è¦å…ˆå°‡çµæ§‹èˆ‡è³‡æ–™åˆ†åˆ¥ dumpï¼Œæ”¹å®Œçµæ§‹å¾Œï¼Œå†å°‡è³‡æ–™ä¸­è¶…éé•·åº¦çš„å€¼åšç¸®æ¸›ï¼Œæœ€å¾Œå†é‡æ–° import åˆ°è³‡æ–™åº«è£¡ã€‚é€™éƒ¨åˆ†å¯åƒè€ƒ XDite é—œæ–¼é€™éƒ¨åˆ†æ‰€æ›¸å¯«çš„"},{"type":"element","tag":"a","props":{"href":"http://blog.xdite.net/posts/2013/12/19/mysql-with-utf8mb4","rel":["nofollow"]},"children":[{"type":"text","value":"éƒ¨è½æ ¼æ–‡ç« "}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"è§£æ±ºæ–¹æ¡ˆ-2"},"children":[{"type":"text","value":"è§£æ±ºæ–¹æ¡ˆ (2)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™å€‹æ–¹æ¡ˆæˆ‘ä¸æ‰“ç®—å¦‚å‰ä¸€å€‹æ–¹æ¡ˆèˆ¬è©³è¿°ï¼Œä¸»è¦æ˜¯å› ç‚ºæˆ‘æ²’æœ‰å¯¦éš›å»å¯¦é©—ï¼Œè€Œåªæ˜¯å°‡ç¶²è·¯ä¸Šçœ‹åˆ°çš„è³‡æ–™åšå€‹æ•´ç†ã€ç­†è¨˜è€Œå·²ï¼Œå¯¦éš›é‹ä½œä¸Šç‹€æ³å¦‚ä½•ï¼Œå°±ä¸æ•¢ä¿è­‰äº†ï¼Œä½†è‡³å°‘ç´€éŒ„äº†ä¸€å€‹æ–¹å‘ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"æ–¹å‘-1"},"children":[{"type":"text","value":"æ–¹å‘"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ MySQL 5.5.14 æ™‚ï¼Œæ–°å¢äº†ä¸€å€‹åç‚ºÂ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"innodb_large_prefix"}]},{"type":"text","value":"Â çš„åŠŸèƒ½ï¼Œå•Ÿç”¨å¾Œå¯å°‡éµå€¼é•·åº¦æ“´å……åˆ° 3072 bytesã€‚è€Œé€™å€‹åŠŸèƒ½ç›¸ä¾æ–¼ MySQL 5.5 æ–°å¢çš„ä¸€å€‹å«åš Barracuda çš„ innodb çš„æª”æ¡ˆæ ¼å¼ï¼ˆFile Formateï¼‰ï¼Œé€™å€‹æª”æ¡ˆæ ¼å¼é™¤äº†æ”¯æ´ innodb åŸæœ‰çš„è³‡æ–™åˆ—æ ¼å¼ï¼ˆRow Formatsï¼‰ï¼Œé‚„åŒ…æ‹¬äº†æ–°çš„è³‡æ–™åˆ—æ ¼å¼ï¼šCOMPRESSED å’Œ DYNAMICã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰€ä»¥è¦è§£æ±ºé€™å€‹å•é¡Œï¼Œå°±æ˜¯ä¿®æ”¹ MySQL çš„é¸é …ï¼Œå°‡æª”æ¡ˆæ ¼å¼æ”¹æˆ Barracudaï¼Œä¸¦ä¸”å•Ÿç”¨ innodb_large_prefix é€™å€‹é¸é …å»æ“´å……éµå€¼é•·åº¦ã€‚æœ€å¾Œåœ¨ Rails å»ºç«‹è¡¨æ ¼æ™‚ï¼ŒæŒ‡å®šä½¿ç”¨ DYNAMIC çš„è³‡æ–™åˆ—æ ¼å¼å³å¯ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"æ–¹æ³•-1"},"children":[{"type":"text","value":"æ–¹æ³•"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"åœ¨é€²è¡Œæœ¬æ–¹æ³•å‰ï¼Œè«‹å…ˆå°‡è³‡æ–™åº«å‚™ä»½ï¼Œæˆ–æ˜¯ä½¿ç”¨è™›æ“¬æ©Ÿå™¨æˆ–æ˜¯å®¹å™¨é–‹ä¸€å€‹æ–°çš„è³‡æ–™åº«ä¼ºæœå™¨ä½œç‚ºç·´ç¿’ã€è©¦é©—"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ MySQL çš„è¨­å®šæª”Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"my.conf"}]},{"type":"text","value":"Â åŠ å…¥ä¸‹é¢å…§å®¹ï¼š"}]},{"type":"element","tag":"code","props":{"code":"[mysqld]\ninnodb_file_format = Barracuda\ninnodb_file_per_table = 1\ninnodb_large_prefix\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[mysqld]\ninnodb_file_format = Barracuda\ninnodb_file_per_table = 1\ninnodb_large_prefix\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ Rails éƒ¨åˆ†æœ‰å…©å€‹é¸é …ï¼Œæ“‡ä¸€å³å¯ï¼Œè¦‹ä»è¦‹æ™ºã€‚æœ‰èˆˆè¶£çš„å¯ä»¥åƒè€ƒåœ¨åŒä¸€ç¯‡ Issue è£¡ï¼Œå¾"},{"type":"element","tag":"a","props":{"href":"https://github.com/rails/rails/issues/9855#issuecomment-57666389","rel":["nofollow"]},"children":[{"type":"text","value":"é€™ç¯‡å›è¦†"}]},{"type":"text","value":"é–‹å§‹çš„è¨è«–ï¼Œä¸»è¦å°±æ˜¯ @NaN1488 å’Œ @yyyc514 å…©äººå›è¦†çš„éƒ¨åˆ†ã€‚"}]},{"type":"element","tag":"h4","props":{"id":"rails-1"},"children":[{"type":"text","value":"Rails (1)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ migration ä¸­çš„Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"create_table"}]},{"type":"text","value":"Â æ–¹æ³•åŠ å…¥Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"option"}]},{"type":"text","value":"Â åƒæ•¸ï¼š"}]},{"type":"element","tag":"code","props":{"code":"create_table :table_name, options: 'ROW_FORMAT=DYNAMIC' do |t|\n  ...\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"create_table :table_name, options: 'ROW_FORMAT=DYNAMIC' do |t|\n  ...\n"}]}]}]},{"type":"element","tag":"h4","props":{"id":"rails-2"},"children":[{"type":"text","value":"Rails (2)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è‹¥æ˜¯è¦ºå¾—è¦åœ¨æ¯å€‹æœ‰å»ºç«‹è³‡æ–™è¡¨çš„ migration ä¸€ä¸€åŠ å…¥ä¸Šè¿°é¸é …çš„åƒæ•¸å¤ªéº»ç…©çš„è©±ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŠ å…¥ä¸€å€‹ MonkeyPatchã€‚é€™å€‹ patch æœƒå¹«ä½ åœ¨å»ºç«‹è³‡æ–™è¡¨æ™‚ç›´æ¥å¹«ä½ åŠ å…¥è©²åƒæ•¸ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ–°å¢Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./config/initializers/ar_innodb_row_format.rb"}]},{"type":"text","value":"Â é€™å€‹æª”æ¡ˆï¼Œä¸¦è²¼ä¸Šç¨‹å¼ç¢¼ï¼š"}]},{"type":"element","tag":"code","props":{"code":"ActiveSupport.on_load :active_record do\n  module ActiveRecord::ConnectionAdapters   \n    class AbstractMysqlAdapter \n      def create_table_with_innodb_row_format(table_name, options = {}) \n        table_options = options.reverse_merge(:options => 'ENGINE=InnoDB ROW_FORMAT=DYNAMIC')\n\n        create_table_without_innodb_row_format(table_name, table_options) do |td|\n         yield td if block_given? \n        end\n      end\n      alias_method_chain :create_table, :innodb_row_format \n    end\n  end\nend\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ActiveSupport.on_load :active_record do\n  module ActiveRecord::ConnectionAdapters   \n    class AbstractMysqlAdapter \n      def create_table_with_innodb_row_format(table_name, options = {}) \n        table_options = options.reverse_merge(:options => 'ENGINE=InnoDB ROW_FORMAT=DYNAMIC')\n\n        create_table_without_innodb_row_format(table_name, table_options) do |td|\n         yield td if block_given? \n        end\n      end\n      alias_method_chain :create_table, :innodb_row_format \n    end\n  end\nend\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"ç¸½çµ-1"},"children":[{"type":"text","value":"ç¸½çµ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"èˆ‡å‰ä¸€æ–¹æ¡ˆæ˜¯é€éä¿®æ”¹ Rails å° string æ¬„ä½é¡å‹çš„é è¨­é•·åº¦é”åˆ°ç›®çš„ï¼Œé€™å€‹æ–¹æ¡ˆå‰‡æ˜¯é€éå‡ç´šã€ä¿®æ”¹ MySQL çš„è¨­å®šæª”ï¼Œæ“´å¤§éµå€¼é•·åº¦å»ä¿®æ­£é€™å€‹éŒ¯èª¤ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"çµèª"},"children":[{"type":"text","value":"çµèª"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å…©å€‹æ–¹æ¡ˆæ–¹å‘ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰å­°å„ªå­°åŠ£ï¼Œå°±çœ‹é–‹ç™¼è€…ç•¶å‰çš„å°ˆæ¡ˆé©åˆå“ªå€‹æ–¹æ¡ˆäº†ã€‚è‹¥æ˜¯æ²’æœ‰è³‡æ–™åº«ä¿®æ”¹æ¬Šé™çš„ï¼Œç¬¬ä¸€å€‹æ–¹æ¡ˆæˆ‘æƒ³å°±æ˜¯ä¸€å€‹æŒºè²¼åˆ‡çš„åšæ³•ï¼Œä¹Ÿè®“å°ˆæ¡ˆåœ¨éƒ¨ç½²çš„é›£åº¦é™ä½ã€‚è‹¥æ˜¯æ“æœ‰è³‡æ–™åº«ä¼ºæœå™¨ç®¡ç†æ¬Šé™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬äºŒå€‹æ–¹æ¡ˆï¼Œç›´æ¥ä¸€å‹æ°¸é€¸å›‰ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"é™„éŒ„unicode-èˆ‡-utf"},"children":[{"type":"text","value":"é™„éŒ„ï¼šUnicode èˆ‡ UTF"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unicode æ˜¯ä¸€ç¨®æ–‡å­—ã€ç¬¦è™Ÿåœ¨é›»è…¦ç§‘å­¸é ˜åŸŸçš„æ¥­ç•Œæ¨™æº–ï¼Œç”±éç‡Ÿåˆ©æ©Ÿæ§‹ The Unicode Consortium è² è²¬ã€‚åœ¨ 1991 å¹´ 10æœˆç™¼å¸ƒç¬¬ä¸€å€‹ç‰ˆæœ¬ï¼Œéš”å¹´ 6 æœˆç™¼å¸ƒ 1.0.1 æ“´å¢äº†ä¸­æ—¥éŸ“çµ±ä¸€è¡¨æ„æ–‡å­—æœ€åˆçš„ 20,902 å€‹å­—ï¼Œä¹‹å¾Œé™¸é™¸çºŒéœ€ç·¨ä¿®èˆ‡æ“´å¢ã€‚æœ€è¿‘çš„ç™¼å¸ƒæ˜¯åœ¨ 2015 å¹´ 6 æœˆæ™‚çš„ 8.0 ç‰ˆæœ¬ï¼Œç¸½è¨ˆæœ‰ 120,737 å€‹å­—ç¬¦ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UTF ç‚º Unicode Transformation Formatï¼Œä¸­æ–‡ç‚º Unicodeè½‰æ›æ ¼å¼ï¼Œå³ç‚º Unicode çš„å¯¦ä½œæ–¹å¼ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"utf-8"},"children":[{"type":"text","value":"UTF-8"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UTF-8 çš„å…¨åç‚º 8-bit Unicode Transformation Formatï¼Œå³ä»¥ 1 å€‹ä½å…ƒçµ„ï¼ˆ1-byte = 8-bitï¼‰ç‚ºå–®ä½ï¼Œç”¨ 1 åˆ° 4 å€‹ä½å…ƒçµ„è¡¨ç¤ºä¸€å€‹å­—ç¬¦ç·¨ç¢¼"},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/293/#fn-293-2","rel":["nofollow"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç”±æ–¼ UTF-8 çš„é•·åº¦æ˜¯å¯è®Šå‹•çš„ï¼Œæ‰€ä»¥ ASCII å¯ä»¥ä½œç‚º UTF-8 çš„ä¸€å€‹å­é›†ï¼Œæ‰€ä»¥ç¾å­˜çš„ ASCII æ–‡å­—ä¸éœ€è¦è½‰æ›ã€‚"}]},{"type":"element","tag":"h4","props":{"id":"utf8mb3utf8mb4"},"children":[{"type":"text","value":"utf8mb3ã€utf8mb4"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"utf8mb3ã€utf8mb4Â éƒ½æ˜¯ MySQL æ‰€æ”¯æ´çš„ Unicode ç·¨ç¢¼å¯¦ä½œï¼Œå…©è€…çš„å·®åˆ¥åœ¨æ–¼Â utf8mb3Â æœ€å¤§ä½”ç”¨é•·åº¦ç‚º 3-byteï¼Œutf8mb4Â å‰‡ç‚º 4-byteã€‚æ‰€ä»¥å…¶å¯¦å…©è€…å¹¾ä¹æ˜¯ä¸€æ¨£çš„ï¼Œä½†æ˜¯Â utf8mb4Â å¤šäº†å°æ“´å……å­—ç¬¦çš„æ”¯æŒï¼Œå¦‚æœ¬ç¯‡æ–‡ç« æ‰€æåˆ°çš„è¡¨æƒ…ç¬¦è™Ÿã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"utf8mb4Â æ˜¯ MySQL 5.5 æ‰€æ–°å¢çš„ï¼Œå› ç‚ºåŸæœ¬ MySQL 5.5 çš„Â utf8Â åªæœ‰æ”¯æŒæœ€å¤§ä½”ç”¨é•·åº¦ç‚º 3-byteï¼Œæ‰€ä»¥æ–°å¢é€™å€‹å¯¦ä½œä½œç‚ºæ“´å……ã€‚åˆ°äº† MySQL 6.0ï¼ŒåŸæœ¬çš„Â utf8Â è¢«æ›´åç‚º utf8mb3ï¼Œä¸¦åŠ å…¥æ–°çš„Â utf8Â ç·¨ç¢¼å¯¦ä½œï¼Œä¸¦é è¨­æ”¯æœ€å¤§ä½”ç”¨é•·åº¦ç‚º 4-byteã€‚"},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/293/#fn-293-3","rel":["nofollow"]},"children":[{"type":"text","value":"2"}]}]},{"type":"element","tag":"h2","props":{"id":"åƒè€ƒè³‡æ–™"},"children":[{"type":"text","value":"åƒè€ƒè³‡æ–™"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/rails/rails/issues/9855","rel":["nofollow"]},"children":[{"type":"text","value":"MySQLÂ utf8mb4Â breaks ActiveRecord schema setup"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mathiasbynens.be/notes/mysql-utf8mb4","rel":["nofollow"]},"children":[{"type":"text","value":"How to support full Unicode in MySQL databases"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://encoding.spec.whatwg.org/#utf-8","rel":["nofollow"]},"children":[{"type":"text","value":"Encoding: Living Standard"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.utf8-chartable.de/unicode-utf8-table.pl?start=128512","rel":["nofollow"]},"children":[{"type":"text","value":"UTF-8 encoding table and Unicode characters"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mothereff.in/byte-counter","rel":["nofollow"]},"children":[{"type":"text","value":"UTF-8 string length & byte counter"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://blog.kamipo.net/entry/2012/11/13/102024","rel":["nofollow"]},"children":[{"type":"text","value":"MySQL(InnoDB) ã§ â€œIndex column size too large. The maximum column size is 767 bytes.â€ ã„ã‚ã‚Œã‚‹ã¨ãã®å¯¾ç­–"}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"åŸä¾†çš„è¦ç¯„å…è¨±é•·é” 6 ä½å…ƒçµ„ï¼Œä½†æ˜¯åœ¨ 2003 å¹´ 11 æœˆ UTF-8 è¢« RFCÂ 3629 é‡æ–°è¦ç¯„ï¼Œåªèƒ½ä½¿ç”¨åŸä¾† Unicode å®šç¾©çš„å€åŸŸï¼Œå³Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"U+0000"}]},{"type":"text","value":"Â åˆ°Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"U+10FFFF"}]},{"type":"text","value":"Â ã€‚Â "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/293/#fnref-293-2","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"â†©","src":"https://s.w.org/images/core/emoji/14.0.0/svg/21a9.svg"},"children":[]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"é€™éƒ¨åˆ†å¯ä»¥åƒç…§Â "},{"type":"element","tag":"a","props":{"href":"http://forums.mysql.com/read.php?3,199803,199803","rel":["nofollow"]},"children":[{"type":"text","value":"MySQL 6.0.4 Alpha çš„ Release Note"}]},{"type":"text","value":"ã€‚Â "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/293/#fnref-293-3","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"â†©","src":"https://s.w.org/images/core/emoji/14.0.0/svg/21a9.svg"},"children":[]}]}]}]}]},"title_en":"MySQL utf8mb4 breaks ActiveRecord schema setup","slug":"my-sql-utf-8-mb-4-breaks-active-record-schema-setup","aliases":["è§£æ±º MySQL ä½¿ç”¨ utf8mb4 ç·¨ç¢¼å°è‡´ Rails è³‡æ–™åº«é·ç§»å¤±æ•—çš„å•é¡Œ","MySQL utf8mb4 breaks ActiveRecord schema setup"],"created_at":"2016-02-21T23:30:29.000Z","published_at":null,"updated_at":null,"tags":["database","mysql","ruby-on-rails","web"],"moc":["Information Technology"],"_type":"markdown","_id":"garden:legacy-articles:2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup.md","_source":"garden","_file":"legacy-articles/2016-02-21-my-sql-utf-8-mb-4-breaks-active-record-schema-setup.md","_extension":"md"},{"_path":"/legacy-articles/2016-09-13-expose-jquery-to-global-variable-with-webpack","_dir":"legacy-articles","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"è®“ jQuery åœ¨ webpack ä¸­æˆç‚ºå…¨åŸŸè®Šæ•¸","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/363/","rel":["nofollow"]},"children":[{"type":"text","value":"è®“ jQuery åœ¨ webpack ä¸­æˆç‚ºå…¨åŸŸè®Šæ•¸ - æ·±è—è‹¥è™›"}]}]},{"type":"element","tag":"h2","props":{"id":"å‰è¨€"},"children":[{"type":"text","value":"å‰è¨€"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™å…©ä¸‰å¹´ï¼Œå¯è¬‚å‰ç«¯æŠ€è¡“æ›´è¿­ä¸æ–·ã€æ¡†æ¶ä¸æ–·æ¨é™³å‡ºæ–°çš„å°–å³°æ™‚æœŸï¼Œæœ¬ä¾†å°±æ¯”è¼ƒæ²’æœ‰å†ç¢°å‰ç«¯æŠ€è¡“ã€ä»¥åŠå°ˆæ³¨åœ¨ç¢©å£«æ±‚å­¸ç”Ÿæ¶¯çš„æˆ‘ä¹Ÿç®—æ˜¯è½å¾Œè¨±å¤šã€‚åœ¨æ‹¿åˆ°ç¢©å£«å­¸ä½å¾Œï¼Œåˆé‡æ–°é–‹å§‹æŠ•å…¥ Web é–‹ç™¼ï¼Œä¸æ–·å­¸ç¿’æ–°çŸ¥ï¼Œå°¤å…¶æ˜¯åœ¨å‰ç«¯æŠ€è¡“æ–¹é¢ã€‚æœ€è¿‘é–‹å§‹ä½¿ç”¨ webpack åšç‚º module bundlerï¼Œé€™ç¯‡ä¸»è¦å°±æ˜¯ç´€éŒ„åˆæœŸä½¿ç”¨ webpack æ™‚é‡åˆ°çš„ä¸€å€‹æ’ç‰†é»ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å„˜ç®¡å‰ç«¯æ¡†æ¶è¶Šä¾†è¶Šå¤šï¼Œangular.jsã€react.js ä»¥åŠæœ€è¿‘ç«„èµ·çš„ vue.js é–‹å§‹ä¸»å°æ•´å€‹ç¶²é å‰æ®µçš„æµç¨‹æ§åˆ¶ä»¥åŠäº‹ä»¶è§¸ç™¼ï¼Œä½†æ˜¯è¨±å¤š CSS æ¡†æ¶ä»æ˜¯ç›¸ä¾åœ¨ jQuery ä¸Šï¼Œä¸”å¯èƒ½æ²’æœ‰å°å…¶ä»– JavaScript æ¡†æ¶æœ‰è‘—å®Œæ•´çš„æ”¯æ´ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ JavaScript æ¡†æ¶ä¹‹é¤˜ï¼Œä»éœ€è¦ä½¿ç”¨ jQuery ä½œç‚ºé©…å‹• CSS æ¡†æ¶çš„æ‰‹æ®µã€‚æœ€è¿‘é–‹å§‹å˜—è©¦ä½¿ç”¨ vue.js èˆ‡ webpack çš„çµ„åˆå»åšç¶²ç«™é–‹ç™¼ï¼Œåœ¨å¥—ç”¨ semantic-ui å’Œ materialize é€™å…©é–€å‰ç«¯è¨­è¨ˆæ¡†æ¶æ™‚ï¼Œå°±é‡åˆ°äº†æ‰¾ä¸åˆ° jQuery å¥—ä»¶åº«çš„éŒ¯èª¤ï¼Œå°è‡´ç¶²ç«™çš„ JavaScrit ç¨‹åºè¢«ä¸­æ–·ï¼Œç„¡æ³•ç¹¼çºŒåŸ·è¡Œä¸‹å»ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"èª¤å€"},"children":[{"type":"text","value":"èª¤å€"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¾ç…§ webpack å»å¼•å…¥ JavaScript çš„å¥—ä»¶ï¼Œä»¥ç‚ºåªè¦åœ¨ js æª”æ¡ˆä¸­åŠ å…¥ä¸‹é¢å…©è¡Œç¨‹å¼ç¢¼å³å¯ã€‚ä½†é¦–å…ˆé‡åˆ°çš„å°±æ˜¯ JSLint ç™¼å‡ºé‡è¤‡ import çš„éŒ¯èª¤ï¼Œç›´æ¥å¦æ±ºæ‰é€™å€‹åšæ³•ã€‚"}]},{"type":"element","tag":"code","props":{"code":"// Error: no-duplicate-imports  'jquery' import is duplicated\nimport $ from 'jquery'\nimport jQuery from 'query'\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Error: no-duplicate-imports  'jquery' import is duplicated\nimport $ from 'jquery'\nimport jQuery from 'query'\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç‚ºäº†é¿é–‹é€™å€‹éŒ¯èª¤ï¼Œæ”¹åªæœ‰ import ä¸€æ¬¡ï¼Œç”¨è®Šæ•¸è³¦å€¼å»æ”¹å–„é€™å€‹å•é¡Œã€‚åœ¨å¼•å…¥ semantic-ui æˆ– materialize æ™‚ï¼Œä»ç„¶å‡ºç¾äº†Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ReferenceError: Can't find variable: jQuery"}]},{"type":"text","value":"Â çš„éŒ¯èª¤ã€‚"}]},{"type":"element","tag":"code","props":{"code":"// Error: ReferenceError: Can't find variable: jQuery\nimport $ from 'jquery'\nvar jQuery = $\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Error: ReferenceError: Can't find variable: jQuery\nimport $ from 'jquery'\nvar jQuery = $\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ¥è‘—ç¨å¾® Googleï¼Œæœ‰äººæåˆ°è¦è®“ jQuery æ›è¼‰ window ç‰©ä»¶ä¸‹æˆç‚ºå…¨åŸŸè®Šæ•¸ï¼Œå°±å¯ä»¥è§£æ±ºå•é¡Œäº†ã€‚æ‰€ä»¥å˜—è©¦ä»¥ä¸‹é¢ç¨‹å¼ç¢¼è§£æ±ºå•é¡Œï¼Œä½†ä»ç„¶å¾—åˆ°Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ReferenceError: Can't find variable: jQuery"}]},{"type":"text","value":"Â çš„éŒ¯èª¤ã€‚"}]},{"type":"element","tag":"code","props":{"code":"// Error: ReferenceError: Can't find variable: jQuery\nimport jquery from 'jquery'\n\nwindow.$ = jquery\nwindow.jQuery = jquery\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Error: ReferenceError: Can't find variable: jQuery\nimport jquery from 'jquery'\n\nwindow.$ = jquery\nwindow.jQuery = jquery\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä»¥ä¸Šè§£æ³•éƒ½å¤±æ•—ã€‚ç›®å‰å°æ–¼ webpack é‚„ä¸ç”šç†Ÿæ‚‰ï¼Œåªæœ‰åœ¨åŒä¸€å€‹æª”æ¡ˆå…§çš„ç¨‹å¼ç¢¼å¯ä»¥ä½¿ç”¨Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":"ã€"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jQuery"}]},{"type":"text","value":"Â å‘¼å« jQueryï¼Œä½†è‹¥æ˜¯ import çš„ JavaScript å¥—ä»¶éœ€è¦ jQuery æ™‚å°±æœƒæ‰¾ä¸åˆ°ï¼Œåœ¨ç¶²é é–‹å•Ÿé–‹ç™¼è€…å·¥å…·å€å‘¼å«é€™å…©å€‹è®Šæ•¸æ™‚ä¹Ÿæœƒæ‰¾ä¸åˆ°ã€‚æ¨ä¼°æ˜¯å› ç‚º webpack å°æ–¼æ¯å€‹æª”æ¡ˆçš„è®Šæ•¸å®£å‘Šçš„ä½œç”¨ç¯„åœ (scope) éƒ½ä¾·é™åœ¨æª”æ¡ˆè£¡ï¼Œä¸æœƒçœŸçš„æˆç‚ºå…¨åŸŸè®Šæ•¸ï¼Œæ‰€ä»¥å°±ç®—æŠŠ jQuery æ›åœ¨Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"window"}]},{"type":"text","value":"Â ç‰©ä»¶å…§ï¼Œä»ç„¡æ³•è§£æ±ºå•é¡Œã€‚é€™å€‹å‡è¨­ç­‰æœªä¾†å°å‰ç«¯æ›´ç†Ÿæ‚‰å¾Œï¼Œå†ä¾†å˜—è©¦é©—è­‰ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"è§£æ³•"},"children":[{"type":"text","value":"è§£æ³•"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ—¢ç„¶ç„¡æ³•å¾å–®å€‹æª”æ¡ˆè§£æ±ºå•é¡Œï¼Œå°±åªå¥½æ›å€‹æ–¹å‘ï¼Œå˜—è©¦ä½¿ç”¨è¨­å®šæª”è§£æ±ºå•é¡Œã€‚ç¹¼çºŒå˜—è©¦ Google å°‹æ‰¾è³‡æ–™ï¼Œå¾—åˆ°å¤§è‡´æœ‰å…©ç¨®è§£æ³•ï¼Œä¸”éƒ½æ˜¯å¯ä»¥é‹ä½œçš„ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸ç®¡æ˜¯ä½•ç¨®è§£æ³•ï¼Œé¦–å…ˆå°±æ˜¯è¦é€é npm å®‰è£ jQueryï¼š"}]},{"type":"element","tag":"code","props":{"code":"npm install --save jquery\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install --save jquery\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç¬¬ä¸€ç¨®æ˜¯ä½¿ç”¨ webpack plugin çš„æ–¹å¼ï¼Œé€é Provide PluginÂ "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/363/#fn-363-1","rel":["nofollow"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"Â è®“ jQuery æˆç‚ºå…¨åŸŸè®Šæ•¸ã€‚ç·¨è¼¯ webpack çš„è¨­å®šæª”ï¼Œåœ¨ module.exports.plugins ä¸­åŠ å…¥ Webpack ProvidePluginsï¼Œä¸¦æŠŠÂ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":"ã€"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jQuery"}]},{"type":"text","value":"Â é€™å…©å€‹å…¨åŸŸè®Šæ•¸æŒ‡å‘Â "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jquery"}]},{"type":"text","value":"Â å¥—ä»¶åº«ã€‚"}]},{"type":"element","tag":"code","props":{"code":"plugins: [\n  // other plugins\n  // ...\n  new webpack.ProvidePlugin({\n     $: \"jquery\",\n     jQuery: \"jquery\"\n  })\n]\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"plugins: [\n  // other plugins\n  // ...\n  new webpack.ProvidePlugin({\n     $: \"jquery\",\n     jQuery: \"jquery\"\n  })\n]\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç¬¬äºŒç¨®è§£æ³•å‰‡æ˜¯ä½¿ç”¨ expose-loaderã€‚é¦–å…ˆå…ˆé€é npm å®‰è£ expose-loaderï¼š"}]},{"type":"element","tag":"code","props":{"code":"npm install expose-loader --save\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install expose-loader --save\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç„¶å¾Œç·¨è¼¯ webpack çš„è¨­å®šæª”ï¼Œåœ¨ module.exports.loaders ä¸­åŠ å…¥ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼ŒæŠŠÂ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jquery"}]},{"type":"text","value":"Â å¥—ä»¶åº«æ­éœ² (expose) æˆÂ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":"ã€"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jQuery"}]},{"type":"text","value":"Â é€™å…©å€‹å…¨åŸŸè®Šæ•¸ã€‚"}]},{"type":"element","tag":"code","props":{"code":"loaders: [\n  // other loaders\n  // ...\n  {\n    test: require.resolve('jquery'),\n    loader: 'expose?jQuery!expose?$'\n  }\n]\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"loaders: [\n  // other loaders\n  // ...\n  {\n    test: require.resolve('jquery'),\n    loader: 'expose?jQuery!expose?$'\n  }\n]\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¨­å®šæª”å®Œæˆå¾Œï¼Œé‡æ–°å•Ÿå‹•ä¼ºæœå™¨ã€‚æ­¤æ™‚ç¶²é ä»æœƒé¡¯ç¤ºÂ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ReferenceError: Can't find variable: jQuery"}]},{"type":"text","value":"Â çš„éŒ¯èª¤ã€‚é€™æ™‚æ‰“é–‹ç¶²é çš„è…³æœ¬ï¼ŒåŠ å…¥ä¸‹é¢çš„ç¨‹å¼ç¢¼å³å¯è§£æ±ºé€™å€‹å•é¡Œã€‚"}]},{"type":"element","tag":"code","props":{"code":"import 'jquery`\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import 'jquery`\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è£œå……ï¼šå¾Œä¾†åœ¨åƒè€ƒè³‡æ–™ç¬¬äºŒé …çš„æ–‡ç« è£¡ï¼Œç™¼ç¾é‚„æœ‰è¨±å¤šå…¶ä»–è§£æ³•ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥å‰å¾€è©²é é¢é–±è®€ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"åƒè€ƒè³‡æ–™"},"children":[{"type":"text","value":"åƒè€ƒè³‡æ–™"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://stackoverflow.com/questions/29080148/expose-jquery-to-real-window-object-with-webpack","rel":["nofollow"]},"children":[{"type":"text","value":"Expose jQuery to real Window object with Webpack"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://stackoverflow.com/questions/28969861/managing-jquery-plugin-dependency-in-webpack","rel":["nofollow"]},"children":[{"type":"text","value":"Managing Jquery plugin dependency in webpack"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://react-china.org/t/webpack-jquery-bootstrap/1669","rel":["nofollow"]},"children":[{"type":"text","value":"React China â€“ æ±‚å¤§ç‰›å¸®å¿™ï¼Œç”¨webpack æ‰“åŒ…jqueryã€bootstrapæ—¶å‡ºé”™ã€‚"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://rhadow.github.io/2015/05/30/webpack-loaders-and-plugins/","rel":["nofollow"]},"children":[{"type":"text","value":"Rhadowâ€™s Tech Note â€“ æ·±å…¥äº†è§£ Webpack Plugins"}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ã€ŒProvide Plugin çš„ä¸»è¦åŠŸèƒ½æ˜¯ç•¶åœ¨ç¨‹å¼ä¸­é‡åˆ°ç‰¹å®šå­—å…ƒä¸”æ²’è¢«å®šç¾©æ™‚æœƒè‡ªå‹•è¼‰å…¥ç‰¹å®šæ¨¡çµ„ã€‚ã€via Ref-4Â "},{"type":"element","tag":"a","props":{"href":"http://blog.fntsr.tw/articles/363/#fnref-363-1","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"â†©","src":"https://s.w.org/images/core/emoji/14.0.0/svg/21a9.svg"},"children":[]}]}]}]}]},"title_en":"Expose jQuery to global variable with Webpack","slug":"expose-jquery-to-global-variable-with-webpack","aliases":["è®“ jQuery åœ¨ webpack ä¸­æˆç‚ºå…¨åŸŸè®Šæ•¸","Expose jQuery to global variable with Webpack"],"created_at":"2016-09-13T14:19:24.000Z","published_at":null,"updated_at":null,"tags":[],"moc":["Information Technology"],"_type":"markdown","_id":"garden:legacy-articles:2016-09-13 -expose-jquery-to-global-variable-with-webpack.md","_source":"garden","_file":"legacy-articles/2016-09-13 -expose-jquery-to-global-variable-with-webpack.md","_extension":"md"}]